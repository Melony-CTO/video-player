

    <!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
      <title>ëœë¤ í”Œë ˆì´ì–´ - ì¢Œìš° ë¶„í•  ì»¨íŠ¸ë¡¤ ì„¼í„°</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      font-family: 'Segoe UI', sans-serif;
      transition: background-image 0.5s ease-in-out;
      scroll-behavior: auto;
    }    video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      opacity: 0;
      transition: opacity 1.5s ease;
    }

    #overlayVideo {
      z-index: 2;
      pointer-events: none;
      mix-blend-mode: screen;
      opacity: 0.2;
    }

    #loop1, #loop2 {
      z-index: 1;
    }

    #logo1, #logo2 {
      z-index: 4;
      pointer-events: none;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      position: fixed;
      top: 0;
      left: 0;
      transform: none;
      transition: opacity 0.5s ease;
      mix-blend-mode: screen;
      opacity: 0;
      visibility: hidden;
      filter: drop-shadow(0 4px 16px rgba(0, 0, 0, 0.3));
    }

    #logo1.test-mode, #logo2.test-mode {
      animation: pulse-logo 2s infinite;
      filter: hue-rotate(120deg) drop-shadow(0 4px 16px rgba(0, 0, 0, 0.3));
    }

    @keyframes pulse-logo {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    /* ===== ì¢Œìš° ë¶„í•  ì»¨íŠ¸ë¡¤ ì„¼í„° íŒ¨ë„ ìŠ¤íƒ€ì¼ ===== */
    .test-panel {
      position: fixed;
      left: 20px;
      top: 20px;
      width: 800px; /* 380pxì—ì„œ 800pxë¡œ í™•ì¥ */
      max-height: 90vh;
      background: rgba(20, 25, 35, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      backdrop-filter: blur(20px);
      color: white;
      overflow-y: auto;
      transform: translateX(-840px); /* í™•ì¥ëœ ë„ˆë¹„ì— ë§ì¶° ì¡°ì • */
      transition: all 0.3s ease;
      z-index: 1000;
      display: flex; /* ì¢Œìš° ë¶„í• ì„ ìœ„í•œ flex ì¶”ê°€ */
      gap: 20px; /* ì¢Œìš° ì„¹ì…˜ ê°„ê²© */
    }
    
    .test-panel.show {
      transform: translateX(0);
    }
    
    .test-panel h3 {
      margin: 0;
      padding: 15px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px 15px 0 0;
      text-align: center;
      font-size: 16px;
      position: absolute; /* ì „ì²´ ìƒë‹¨ì— ë°°ì¹˜ */
      top: 0;
      left: 0;
      right: 0;
      z-index: 10;
    }

    /* ===== ì¢Œìš° ë¶„í•  ì„¹ì…˜ ìŠ¤íƒ€ì¼ ===== */
    .control-section {
      flex: 1;
      padding: 60px 15px 15px 15px; /* ìƒë‹¨ íŒ¨ë”©ì„ ëŠ˜ë ¤ì„œ ì œëª© ê³µê°„ í™•ë³´ */
      max-height: calc(90vh - 60px);
      overflow-y: auto;
    }

    .left-section {
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      padding-right: 20px;
    }

    .right-section {
      padding-left: 20px;
    }

    /* ì„¹ì…˜ ì œëª© ìŠ¤íƒ€ì¼ */
    .section-title {
      font-size: 18px;
      font-weight: bold;
      color: #4FC3F7;
      text-align: center;
      margin-bottom: 20px;
      padding: 10px;
      background: rgba(79, 195, 247, 0.1);
      border-radius: 10px;
      border: 1px solid rgba(79, 195, 247, 0.3);
    }
    
    .test-section {
      padding: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 10px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.02);
    }
    
    .test-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }
    
    .test-section h4 {
      margin: 0 0 10px 0;
      font-size: 14px;
      color: #4FC3F7;
    }

    /* íŒŒì¼ ì—…ë¡œë“œ ë“œë˜ê·¸ì•¤ë“œë¡­ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .upload-zone {
      border: 2px dashed rgba(79, 195, 247, 0.5);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      margin: 10px 0;
      background: rgba(79, 195, 247, 0.05);
      transition: all 0.3s ease;
      cursor: pointer;
      position: relative;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .upload-zone:hover {
      border-color: rgba(79, 195, 247, 0.8);
      background: rgba(79, 195, 247, 0.1);
      transform: translateY(-2px);
    }

    .upload-zone.drag-over {
      border-color: #4FC3F7;
      background: rgba(79, 195, 247, 0.2);
      box-shadow: 0 0 20px rgba(79, 195, 247, 0.3);
    }

    .upload-zone-text {
      font-size: 12px;
      color: #90A4AE;
      margin: 5px 0;
    }

    .upload-zone-icon {
      font-size: 24px;
      color: #4FC3F7;
      margin-bottom: 10px;
    }

    /* í”„ë¦¬ì…‹ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
    .preset-controls {
      display: flex;
      gap: 8px;
      margin: 10px 0;
      flex-wrap: wrap;
    }

    .preset-btn {
      padding: 6px 12px;
      background: linear-gradient(135deg, #4FC3F7, #29B6F6);
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.3s ease;
      flex: 1;
      min-width: 60px;
    }

    .preset-btn:hover {
      background: linear-gradient(135deg, #29B6F6, #03A9F4);
      transform: translateY(-1px);
    }

    .preset-btn.save {
      background: linear-gradient(135deg, #4CAF50, #66BB6A);
    }

    .preset-btn.load {
      background: linear-gradient(135deg, #FF9800, #FFB74D);
    }

    .preset-btn.delete {
      background: linear-gradient(135deg, #F44336, #E57373);
    }

    /* ë°°ê²½ ì´ë¯¸ì§€ ì„ íƒ */
    .background-item {
      margin: 5px 0;
      display: flex;
      align-items: center;
    }
    
    .background-item input[type="radio"] {
      margin-right: 8px;
    }
    
    .background-item label {
      font-size: 12px;
      cursor: pointer;
    }
    
    /* í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì„ íƒ */
    .playlist-item-selector {
      margin: 5px 0;
      display: flex;
      align-items: center;
    }
    
    .playlist-item-selector input[type="checkbox"] {
      margin-right: 8px;
    }
    
    .playlist-item-selector label {
      font-size: 12px;
      cursor: pointer;
    }
    
    .shuffle-option {
      margin: 10px 0;
      padding: 8px;
      background: rgba(76, 175, 80, 0.2);
      border-radius: 8px;
      display: flex;
      align-items: center;
    }
    
    .shuffle-option input {
      margin-right: 8px;
    }
    
    /* EQ ì»¨íŠ¸ë¡¤ */
    .eq-control {
      margin: 8px 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .eq-label {
      font-size: 12px;
      width: 40px;
    }
    
    .eq-slider {
      flex: 1;
      margin: 0 10px;
    }
    
    .eq-value {
      font-size: 11px;
      width: 40px;
      text-align: right;
    }
    
    /* ë³¼ë¥¨ ìƒíƒœ */
    .volume-status {
      font-size: 11px;
      line-height: 1.4;
      background: rgba(255, 255, 255, 0.05);
      padding: 8px;
      border-radius: 8px;
    }
    
    /* íš¨ê³¼ìŒ ë³¼ë¥¨ ì»¨íŠ¸ë¡¤ */
    .control-slider {
      margin: 8px 0;
      padding: 8px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      transition: background 0.3s ease;
    }
    
    .control-slider.active {
      background: rgba(76, 175, 80, 0.2);
      border: 1px solid rgba(76, 175, 80, 0.5);
    }
    
    .control-slider.master-volume {
      background: rgba(255, 152, 0, 0.2);
      border: 1px solid rgba(255, 152, 0, 0.3);
    }
    
    .control-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }
    
    .effect-name {
      font-size: 12px;
      font-weight: bold;
    }
    
    .channel-info {
      font-size: 10px;
      color: #90A4AE;
      background: rgba(255, 255, 255, 0.1);
      padding: 2px 6px;
      border-radius: 10px;
    }
    
    .slider-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .control-range {
      flex: 1;
      -webkit-appearance: none;
      height: 4px;
      border-radius: 2px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
    }
    
    .control-range::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #4FC3F7;
      cursor: pointer;
    }
    
    .control-range::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #4FC3F7;
      cursor: pointer;
      border: none;
    }
    
    .test-btn {
      background: #4FC3F7;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .test-btn:hover {
      background: #29B6F6;
    }
    
    .control-value {
      font-size: 11px;
      color: #4FC3F7;
      text-align: center;
      margin-top: 2px;
    }
    
    /* í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ í‘œì‹œ - ìŠ¤í¬ë¡¤ ì¶”ê°€ */
    .playlist-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 8px;
      margin: 2px 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
      font-size: 11px;
      min-height: 20px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    
    .playlist-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .playlist-item.current {
      background: rgba(76, 175, 80, 0.4);
      border: 2px solid rgba(76, 175, 80, 0.8);
      box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
      animation: currentTrackPulse 2s infinite;
    }
    
    @keyframes currentTrackPulse {
      0% { box-shadow: 0 0 10px rgba(76, 175, 80, 0.3); }
      50% { box-shadow: 0 0 20px rgba(76, 175, 80, 0.6); }
      100% { box-shadow: 0 0 10px rgba(76, 175, 80, 0.3); }
    }
    
    .track-info {
      font-size: 9px;
      color: #90A4AE;
      margin: 0 5px;
    }
    
    .track-status {
      font-size: 10px;
    }
    
    .track-status.available {
      color: #4CAF50;
    }
    
    /* í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë””ìŠ¤í”Œë ˆì´ ì»¨í…Œì´ë„ˆ */
    #playlistDisplay {
      max-height: 180px;
      overflow-y: auto;
      overflow-x: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.2);
      padding: 5px;
      scroll-behavior: smooth;
    }
    
    #playlistDisplay::-webkit-scrollbar {
      width: 8px;
    }
    
    #playlistDisplay::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
    }
    
    #playlistDisplay::-webkit-scrollbar-thumb {
      background: rgba(76, 175, 80, 0.6);
      border-radius: 4px;
      min-height: 20px;
    }
    
    #playlistDisplay::-webkit-scrollbar-thumb:hover {
      background: rgba(76, 175, 80, 0.8);
    }
    
    /* ë¡œê·¸ ë””ìŠ¤í”Œë ˆì´ */
    .log-display {
      max-height: 150px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 8px;
      font-family: 'Courier New', monospace;
      font-size: 10px;
      line-height: 1.3;
    }
    
    .log-entry {
      margin: 1px 0;
      padding: 2px;
    }
    
    .log-entry.info {
      color: #81C784;
    }
    
    .log-entry.error {
      color: #E57373;
    }
    
    .log-entry.warning {
      color: #FFB74D;
    }
    
    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ë§ */
    .test-panel::-webkit-scrollbar,
    .log-display::-webkit-scrollbar,
    .control-section::-webkit-scrollbar {
      width: 6px;
    }
    
    .test-panel::-webkit-scrollbar-track,
    .log-display::-webkit-scrollbar-track,
    .control-section::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }
    
    .test-panel::-webkit-scrollbar-thumb,
    .log-display::-webkit-scrollbar-thumb,
    .control-section::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.3);
      border-radius: 3px;
    }
    
    .test-panel::-webkit-scrollbar-thumb:hover,
    .log-display::-webkit-scrollbar-thumb:hover,
    .control-section::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.5);
    }

    #startButton {
      padding: 18px 36px;
      font-size: 20px;
      font-weight: 600;
      color: white;
      background: linear-gradient(135deg, #ff6b81, #6bc1ff);
      border: none;
      border-radius: 40px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
      animation: pulse 2s infinite;
      z-index: 100;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    #startButton:hover {
      transform: translate(-50%, -50%) scale(1.05);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    }

    @keyframes pulse {
      0% {
        transform: translate(-50%, -50%) scale(1);
        box-shadow: 0 0 0 0 rgba(255, 107, 129, 0.7);
      }
      70% {
        transform: translate(-50%, -50%) scale(1.05);
        box-shadow: 0 0 0 20px rgba(255, 107, 129, 0);
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
        box-shadow: 0 0 0 0 rgba(255, 107, 129, 0);
      }
    }

    /* ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
    .control-panel {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 15;
      display: flex;
      align-items: center;
      gap: 20px;
      padding: 8px 20px;
      background: rgba(243, 208, 147, 0.3);
      backdrop-filter: blur(20px);
      border-radius: 25px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
      opacity: 0;
      transition: all 0.5s ease;
    }

    .control-panel.show {
      opacity: 1;
    }

    /* ì œëª© í‘œì‹œ */
    .title-display {
      position: fixed;
      bottom: 75px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.005);
      backdrop-filter: blur(1px);
      color: #fff;
      padding: 20px 30px;
      border-radius: 15px;
      font-size: 15px;
      font-weight: 500;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      text-align: center;
      z-index: 16;
      opacity: 0.5;
      transition: all 0.5s ease;
      border: 1px solid rgba(255, 255, 255, 0.01);
      box-shadow: 0 2px 16px rgba(0, 0, 0, 0.01);
      white-space: nowrap;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .title-display.show {
      opacity: 1;
    }

    /* ì‹¤ì‹œê°„ ì˜¤ë””ì˜¤ ë¹„ì£¼ì–¼ë¼ì´ì € */
    .audio-visualizer {
      display: flex;
      align-items: end;
      gap: 3px;
      height: 30px;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .audio-visualizer.playing {
      opacity: 1;
    }

    .visualizer-bar {
      width: 3px;
      background: rgba(255, 255, 255, 1.0);
      border-radius: 2px;
      transition: height 0.05s ease;
      min-height: 2px;
      box-shadow: 0 0 8px rgba(255, 255, 255, 1.0);
    }

    /* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ë“¤ */
    .control-btn {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
    }

    .control-btn:hover {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.2));
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.8);
    }

    .play-btn {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #f093fb, #f5576c);
      font-size: 18px;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .play-btn:hover {
      background: linear-gradient(135deg, #f5576c, #f093fb);
      transform: scale(1.05);
      box-shadow: 0 6px 25px rgba(240, 147, 251, 0.4);
    }

    .player-buttons {
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: center;
    }

    .shuffle-btn.active {
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.8), rgba(255, 152, 0, 0.8));
      box-shadow: 0 4px 15px rgba(255, 193, 7, 0.5);
    }

    .control-btn.next-btn {
      background: linear-gradient(135deg, rgba(255, 193, 7, 0.8), rgba(255, 152, 0, 0.8)) !important;
      box-shadow: 0 4px 15px rgba(255, 193, 7, 0.5);
    }

    .control-btn.next-btn:hover {
      background: linear-gradient(135deg, rgba(255, 152, 0, 0.9), rgba(255, 193, 7, 0.9)) !important;
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(255, 193, 7, 0.6);
    }

    /* íš¨ê³¼ìŒ ë²„íŠ¼ë“¤ */
    .effect-group {
      display: flex;
      gap: 8px;
    }

    .effect-button {
      padding: 8px 16px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
      color: white;
      border: none;
      border-radius: 18px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }

    .effect-button:hover {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25));
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
    }

    .effect-button.active {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-color: #667eea;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transform: translateY(-1px);
    }

    .player-controls {
      background: transparent;
      border-radius: 0;
      backdrop-filter: none;
      border: none;
      box-shadow: none;
      padding: 0;
    }

    /* ===== Melony.j ë¡œê³  ìŠ¤íƒ€ì¼ ===== */
    .logo-container {
      position: absolute;
      right: 40px;
      bottom: 40px;
      z-index: 1000;
      transition: all 0.4s ease;
    }

    .melony-logo {
      position: relative;
      width: 40px;
      height: 30px;
      border-radius: 50%;
      background: rgba(255,255,255,0.4);
      -webkit-mask: url('MelonyJ_Logo.png') no-repeat center center;
      -webkit-mask-size: 45px;
      mask: url('MelonyJ_Logo.png') no-repeat center center;
      mask-size: 45px;
      background-size: 45px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
      cursor: pointer;
      transition: all 0.3s ease;
      overflow: visible;
      border: none;
    }

    .melony-logo img {
      display: none;
    }

    .logo-text {
      display: none;
    }

    .logo-text {
      font-size: 6px;
      font-weight: 300;
      color: white;
      text-align: center;
      font-family: 'Georgia', serif;
      letter-spacing: 0.2px;
      z-index: 2;
      position: relative;
    }

    .logo-text .dot {
      color: #ffd89b;
      font-weight: bold;
    }

    /* í–‰ì„± ê¶¤ë„ */
    .orbit {
      position: absolute;
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      animation: rotate 8s linear infinite;
    }

    .orbit-1 {
      width: 56px;
      height: 56px;
      top: -8px;
      left: -8px;
    }

    .orbit-2 {
      width: 70px;
      height: 70px;
      top: -15px;
      left: -15px;
      animation-duration: 12s;
      animation-direction: reverse;
    }

    /* í–‰ì„±ë“¤ */
    .planet {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      box-shadow: 0 0 6px currentColor;
    }

    /* ì²« ë²ˆì§¸ ê¶¤ë„ í–‰ì„±ë“¤ */
    .planet-1 {
      top: 0;
      left: 50%;
      margin-left: -2px;
      margin-top: -2px;
      background: #ffd89b;
      color: #ffd89b;
    }

    .planet-2 {
      top: 50%;
      right: 0;
      margin-top: -2px;
      margin-right: -2px;
      background: #ff9a9e;
      color: #ff9a9e;
    }

    .planet-3 {
      bottom: 0;
      left: 50%;
      margin-left: -2px;
      margin-bottom: -2px;
      background: #a8edea;
      color: #a8edea;
    }

    .planet-4 {
      top: 50%;
      left: 0;
      margin-top: -2px;
      margin-left: -2px;
      background: #fecfef;
      color: #fecfef;
    }

    /* ë‘ ë²ˆì§¸ ê¶¤ë„ í–‰ì„± */
    .planet-5 {
      top: 12%;
      right: 12%;
      background: #fed6e3;
      color: #fed6e3;
    }

    /* íšŒì „ ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

  <!-- ===== ì¢Œìš° ë¶„í•  ì»¨íŠ¸ë¡¤ ì„¼í„° íŒ¨ë„ ===== -->
  <div id="controlCenter" class="test-panel">
    <h3>ğŸ›ï¸ ìŒì•… ì»¨íŠ¸ë¡¤ ì„¼í„° - ì¢Œìš° ë¶„í•  ë²„ì „</h3>
    
    <!-- ===== ì™¼ìª½ ì„¹ì…˜: ë°©ì†¡ ì»¨íŠ¸ë¡¤ ğŸµ ===== -->
    <div class="control-section left-section">
      <div class="section-title">ğŸµ ë°©ì†¡ ì»¨íŠ¸ë¡¤</div>
      
      <!-- í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì„ íƒ/ê´€ë¦¬ -->
      <div class="test-section">
        <div id="playlistSelector">
          <h4>ğŸµ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬</h4>
        </div>
      </div>
      
      <!-- í˜„ì¬ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ í‘œì‹œ -->
      <div class="test-section">
        <h4>ğŸ“‹ í˜„ì¬ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</h4>
        <div id="shuffleStatus">ì…”í”Œ ëª¨ë“œ: OFF</div>
        <div id="playlistDisplay" style="margin-top: 8px;"></div>
      </div>
      
      <!-- ì´í€„ë¼ì´ì € ì„¤ì • -->
      <div class="test-section">
        <h4>ğŸ›ï¸ ì´í€„ë¼ì´ì € ì„¤ì •</h4>
        <div class="eq-control">
          <span class="eq-label">Low</span>
          <input type="range" id="eqLowSlider" class="eq-slider" min="-10" max="10" step="0.5" value="4">
          <span class="eq-value" id="eqLowValue">4dB</span>
        </div>
        <div class="eq-control">
          <span class="eq-label">Mid</span>
          <input type="range" id="eqMidSlider" class="eq-slider" min="-10" max="10" step="0.5" value="2.5">
          <span class="eq-value" id="eqMidValue">2.5dB</span>
        </div>
        <div class="eq-control">
          <span class="eq-label">High</span>
          <input type="range" id="eqHighSlider" class="eq-slider" min="-10" max="10" step="0.5" value="-2">
          <span class="eq-value" id="eqHighValue">-2dB</span>
        </div>
      </div>
      
      <!-- ìŒëŸ‰ ì¡°ì ˆ í˜„í™© -->
      <div class="test-section">
        <h4>ğŸ”Š ìŒëŸ‰ ì¡°ì ˆ í˜„í™©</h4>
        <div id="volumeStatus" class="volume-status">
          í˜„ì¬ íŠ¸ë™: ì—†ìŒ<br>
          ì¬ìƒ ìƒíƒœ: ì •ì§€<br>
          ë³¼ë¥¨: 50%<br>
          ë¶„ì„ ìƒíƒœ: ëŒ€ê¸° ì¤‘
        </div>
      </div>
      
      <!-- ë§ˆìŠ¤í„° ë³¼ë¥¨ -->
      <div class="test-section">
        <h4>ğŸµ ë§ˆìŠ¤í„° ë³¼ë¥¨</h4>
        <div class="control-slider master-volume" id="masterVolumeControl">
          <div class="control-label">
            <span class="effect-name">ë§ˆìŠ¤í„° ë³¼ë¥¨</span>
            <span class="channel-info">MASTER</span>
          </div>
          <div class="slider-container">
            <input type="range" class="control-range" id="master-volume-slider-main" 
                   min="0" max="100" step="5" value="50">
          </div>
          <div class="control-value" id="master-volume-value-main">50%</div>
        </div>
      </div>
      
      <!-- íš¨ê³¼ìŒ ë³¼ë¥¨ (8ì±„ë„) -->
      <div class="test-section">
        <div id="effectVolumeControls">
          <h4>ğŸ”Š íš¨ê³¼ìŒ ë³¼ë¥¨ (8ì±„ë„)</h4>
        </div>
      </div>
      
      <!-- ìŠ¤í…”ìŠ¤ ëª¨ë“œ -->
      <div class="test-section">
        <h4>ğŸ‘» ìŠ¤í…”ìŠ¤ ëª¨ë“œ</h4>
        <div style="margin-bottom: 15px;">
          <div style="display: flex; gap: 8px; margin-bottom: 10px; flex-wrap: wrap;">
            <button onclick="applyStealthPreset('ninja')" style="padding: 6px 12px; background: #2C3E50; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 11px;">ğŸ¥· ë‹Œì</button>
            <button onclick="applyStealthPreset('ghost')" style="padding: 6px 12px; background: #34495E; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 11px;">ğŸ‘» ê³ ìŠ¤íŠ¸</button>
            <button onclick="applyStealthPreset('hover')" style="padding: 6px 12px; background: #8E24AA; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 11px;">âœ¨ í˜¸ë²„</button>
            <button onclick="applyStealthPreset('reset')" style="padding: 6px 12px; background: #FF5722; color: white; border: none; border-radius: 15px; cursor: pointer; font-size: 11px;">ğŸ”„ ë¦¬ì…‹</button>
          </div>
        </div>
        
        <div class="control-slider" style="margin-bottom: 8px;">
          <div class="control-label">
            <span class="effect-name">íŒ¨ë„ íˆ¬ëª…ë„</span>
            <span class="channel-info">PANEL</span>
          </div>
          <div class="slider-container">
            <input type="range" class="control-range" id="stealth-panel-slider" 
                   min="0" max="100" step="5" value="30">
          </div>
          <div class="control-value" id="stealth-panel-value">30%</div>
        </div>
        
        <div class="control-slider" style="margin-bottom: 8px;">
          <div class="control-label">
            <span class="effect-name">ë²„íŠ¼ íˆ¬ëª…ë„</span>
            <span class="channel-info">BUTTON</span>
          </div>
          <div class="slider-container">
            <input type="range" class="control-range" id="stealth-button-slider" 
                   min="0" max="100" step="5" value="100">
          </div>
          <div class="control-value" id="stealth-button-value">100%</div>
        </div>
        
        <div class="control-slider">
          <div class="control-label">
            <span class="effect-name">ë¸”ëŸ¬ íš¨ê³¼</span>
            <span class="channel-info">BLUR</span>
          </div>
          <div class="slider-container">
            <input type="range" class="control-range" id="stealth-blur-slider" 
                   min="0" max="40" step="2" value="20">
          </div>
          <div class="control-value" id="stealth-blur-value">20px</div>
        </div>
        
        <div style="margin-top: 10px; padding: 8px; background: rgba(255, 255, 255, 0.05); border-radius: 8px;">
          <label style="display: flex; align-items: center; font-size: 11px;">
            <input type="checkbox" id="stealth-hover-enable" checked style="margin-right: 8px;">
            í˜¸ë²„ ì‹œ ë³µì› íš¨ê³¼ í™œì„±í™”
          </label>
        </div>
      </div>
    </div>
    
    
    
        <!-- ===== ì˜¤ë¥¸ìª½ ì„¹ì…˜: ë¯¸ë””ì–´ íŒŒì¼ ê´€ë¦¬ ğŸ“ =7892==== -->
    <div class="control-section right-section">
      <div class="section-title">ğŸ“ ë¯¸ë””ì–´ íŒŒì¼ ê´€ë¦¬</div>
      
      <!-- ë°°ê²½ ì„¤ì • (ì´ë¯¸ì§€/ë¹„ë””ì˜¤ í† ê¸€ + ë“œë˜ê·¸&ë“œë¡­) -->
      <div class="test-section">
        <h4>ğŸ–¼ï¸ ë°°ê²½ ì„¤ì •</h4>
        <div class="upload-zone" id="backgroundUploadZone">
          <div class="upload-zone-icon">ğŸ“</div>
          <div class="upload-zone-text">ì´ë¯¸ì§€ ë˜ëŠ” ë¹„ë””ì˜¤ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
          <div class="upload-zone-text">ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ ì„ íƒ</div>
        </div>
        
        <div style="display: flex; gap: 10px; margin-top: 10px;">
          <label style="display: flex; align-items: center; font-size: 12px;">
            <input type="radio" name="backgroundType" value="image" checked style="margin-right: 5px;">
            ì´ë¯¸ì§€ ëª¨ë“œ
          </label>
          <label style="display: flex; align-items: center; font-size: 12px;">
            <input type="radio" name="backgroundType" value="video" style="margin-right: 5px;">
            ë¹„ë””ì˜¤ ëª¨ë“œ
          </label>
        </div>
      </div>
    
            <!-- ìë™ ë°°ê²½ ì´ë¯¸ì§€ ê²€ìƒ‰ (ê¸°ì¡´ ê¸°ëŠ¥ ì´ë™) -->
      <div class="test-section">
        <div id="backgroundSelector">
          <h4>ğŸ² ìë™ ë°°ê²½ ì´ë¯¸ì§€ ê²€ìƒ‰</h4>
        </div>
      </div>

      
      <!-- ì˜¤ë²„ë ˆì´ ì„¤ì • (ë“œë˜ê·¸&ë“œë¡­ ì—…ë¡œë“œ) -->
      <div class="test-section">
        <h4>ğŸ­ ì˜¤ë²„ë ˆì´ ì„¤ì •</h4>
        <div class="upload-zone" id="overlayUploadZone">
          <div class="upload-zone-icon">ğŸ­</div>
          <div class="upload-zone-text">ì˜¤ë²„ë ˆì´ ë¹„ë””ì˜¤ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
          <div class="upload-zone-text">PNG/MOV/MP4 íŒŒì¼ ì§€ì›</div>
        </div>
        <div style="margin-top: 10px;">
          <label style="display: flex; align-items: center; font-size: 12px;">
            <input type="checkbox" id="overlayEnabled" checked style="margin-right: 8px;">
            ì˜¤ë²„ë ˆì´ í™œì„±í™”
          </label>
        </div>
      </div>
      
       <!-- ì˜¤ë²„ë ˆì´ í™œì„±í™” ë° ì ìš© ë²„íŠ¼ -->
  <div style="margin-top: 10px; display: flex; gap: 10px; align-items: center;">
    <label style="display: flex; align-items: center; font-size: 12px;">
      <input type="checkbox" id="overlayEnabled" checked style="margin-right: 8px;">
      ì˜¤ë²„ë ˆì´ í™œì„±í™”
    </label>
    <button id="applyOverlayBtn" class="preset-btn" style="padding: 4px 12px; font-size: 11px; background: #4CAF50;" disabled onclick="applyOverlay()">âœ… ì ìš©</button>
  </div>
  
  <!-- ì˜¤ë²„ë ˆì´ íˆ¬ëª…ë„ ì¡°ì ˆ -->
  <div class="control-slider" style="margin-top: 12px;">
    <div class="control-label">
      <span class="effect-name">ì˜¤ë²„ë ˆì´ íˆ¬ëª…ë„</span>
      <span class="channel-info">OPACITY</span>
    </div>
    <div class="slider-container">
      <input type="range" class="control-range" id="overlay-opacity-slider" 
             min="0" max="100" step="5" value="20">
    </div>
    <div class="control-value" id="overlay-opacity-value">20%</div>
  </div>

    <!-- ë¯¹ìŠ¤ ë¸”ë Œë“œ ëª¨ë“œ ì„ íƒ -->
  <div style="margin-top: 10px;">
    <label style="font-size: 11px; color: #90A4AE; margin-bottom: 5px; display: block;">ë¸”ë Œë“œ ëª¨ë“œ:</label>
    <select id="overlayBlendMode" style="width: 100%; padding: 4px 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: white; font-size: 11px;">
      <option value="screen">Screen (ê¸°ë³¸)</option>
      <option value="normal">Normal</option>
      <option value="multiply">Multiply</option>
      <option value="overlay">Overlay</option>
      <option value="soft-light">Soft Light</option>
      <option value="hard-light">Hard Light</option>
      <option value="color-dodge">Color Dodge</option>
      <option value="color-burn">Color Burn</option>
    </select>
  </div>

  

  <!-- ìƒíƒœ í‘œì‹œ -->
<div id="overlayFileStatus" style="margin-top: 8px; font-size: 11px; color: #90A4AE;">
  í˜„ì¬: ê¸°ë³¸ ì˜¤ë²„ë ˆì´ (overlay01.mp4)
</div>


      
      <!-- í”„ë¦¬ì…‹ ê´€ë¦¬ (ì €ì¥/ë¡œë“œ/ì‚­ì œ) -->
      <div class="test-section">
        <h4>ğŸ’¾ í”„ë¦¬ì…‹ ê´€ë¦¬</h4>
        <div class="preset-controls">
          <button class="preset-btn save" onclick="savePreset()">ğŸ’¾ ì €ì¥</button>
          <button class="preset-btn load" onclick="loadPreset()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button class="preset-btn delete" onclick="deletePreset()">ğŸ—‘ï¸ ì‚­ì œ</button>
          <button class="preset-btn" onclick="exportPreset()">ğŸ“¤ ë‚´ë³´ë‚´ê¸°</button>
        </div>
        <div style="margin-top: 10px;">
          <input type="text" id="presetName" placeholder="í”„ë¦¬ì…‹ ì´ë¦„ ì…ë ¥..." 
                 style="width: 100%; padding: 8px; border: 1px solid rgba(255,255,255,0.2); border-radius: 5px; background: rgba(255,255,255,0.1); color: white; font-size: 12px;">
        </div>
        <div id="presetList" style="margin-top: 10px; max-height: 100px; overflow-y: auto; font-size: 11px;">
          <!-- ì €ì¥ëœ í”„ë¦¬ì…‹ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>
      </div>
      
        <!-- ì¸íŠ¸ë¡œ í™œì„±í™” ë° ì ìš© ë²„íŠ¼ -->
  <div style="margin-top: 10px; display: flex; gap: 10px; align-items: center;">
    <label style="display: flex; align-items: center; font-size: 12px;">
      <input type="checkbox" id="introEnabled" checked style="margin-right: 8px;">

      ì¸íŠ¸ë¡œ í™œì„±í™”
    </label>
    <button id="applyIntroBtn" class="preset-btn" style="padding: 4px 12px; font-size: 11px; background: #4CAF50;" disabled onclick="applyIntro()">âœ… ì ìš©</button>
  </div>

   <!-- ì¸íŠ¸ë¡œ íˆ¬ëª…ë„ ì¡°ì ˆ (ì˜¤ë²„ë ˆì´ì™€ ë™ì¼) -->
  <div class="control-slider" style="margin-top: 12px;">
    <div class="control-label">
      <span class="effect-name">ì¸íŠ¸ë¡œ íˆ¬ëª…ë„</span>
      <span class="channel-info">OPACITY</span>
    </div>
    <div class="slider-container">
      <input type="range" class="control-range" id="intro-opacity-slider" 
             min="0" max="100" step="5" value="80">
    </div>
    <div class="control-value" id="intro-opacity-value">80%</div>
  </div>

    <!-- ì¸íŠ¸ë¡œ ë¸”ë Œë“œ ëª¨ë“œ ì„ íƒ (ì˜¤ë²„ë ˆì´ì™€ ë™ì¼) -->
  <div style="margin-top: 10px;">
    <label style="font-size: 11px; color: #90A4AE; margin-bottom: 5px; display: block;">ì¸íŠ¸ë¡œ ë¸”ë Œë“œ ëª¨ë“œ:</label>
    <select id="introBlendMode" style="width: 100%; padding: 4px 8px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; color: white; font-size: 11px;">
      <option value="screen">Screen (ê¸°ë³¸)</option>
      <option value="normal">Normal</option>
      <option value="multiply">Multiply</option>
      <option value="overlay">Overlay</option>
      <option value="soft-light">Soft Light</option>
      <option value="hard-light">Hard Light</option>
      <option value="color-dodge">Color Dodge</option>
      <option value="color-burn">Color Burn</option>
    </select>
  </div>

    <!-- ìƒíƒœ í‘œì‹œ -->
  <div id="introFileStatus" style="margin-top: 8px; font-size: 11px; color: #90A4AE;">
    í˜„ì¬: ì¸íŠ¸ë¡œ ì—†ìŒ
  </div>

    <div style="margin-top: 8px; font-size: 10px; color: #FFB74D; background: rgba(255, 183, 77, 0.1); padding: 5px; border-radius: 4px;">
    ğŸ’¡ ì¸íŠ¸ë¡œëŠ” <strong>í•œ ë²ˆë§Œ</strong> ì¬ìƒë˜ë©°, ë©”ì¸ ì˜ìƒê³¼ í•¨ê»˜ ì˜¤ë²„ë ˆì´ë¡œ í‘œì‹œë©ë‹ˆë‹¤!
  </div>

      <!-- ì‹œìŠ¤í…œ ë¡œê·¸ -->
      <div class="test-section">
        <h4>ğŸ“œ ì‹œìŠ¤í…œ ë¡œê·¸</h4>
        <div id="logDisplay" class="log-display">
          <div class="log-entry info">[ì‹œìŠ¤í…œ] ì¢Œìš° ë¶„í•  ì»¨íŠ¸ë¡¤ ì„¼í„° ì¤€ë¹„ ì™„ë£Œ</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì œëª© í‘œì‹œ -->
  <div class="title-display" id="titleDisplay">
    <!-- ì‹¤ì‹œê°„ ì˜¤ë””ì˜¤ ë¹„ì£¼ì–¼ë¼ì´ì € (40ê°œ ë°”) -->
    <div class="audio-visualizer" id="audioVisualizer">
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
      <div class="visualizer-bar"></div>
    </div>
  </div>

  <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
  <div class="control-panel" id="controlPanel">
    <!-- ì™¼ìª½ íš¨ê³¼ìŒ ê·¸ë£¹ -->
    <div class="effect-group">
      <button class="effect-button" onclick="toggleEffect('rain')">Rain</button>
      <button class="effect-button" onclick="toggleEffect('bird')">Bird</button>
      <button class="effect-button" onclick="toggleEffect('forest')">Forest</button>
      <button class="effect-button" onclick="toggleEffect('crickets')">Crickets</button>
    </div>

    <!-- ì¤‘ì•™ í”Œë ˆì´ì–´ ì»¨íŠ¸ë¡¤ -->
    <div class="player-controls">
      <div class="player-buttons">
        <button class="control-btn shuffle-btn" id="shuffleBtn" onclick="toggleShuffle()" title="ì…”í”Œ ì˜¨/ì˜¤í”„">â®</button>
        <button class="control-btn play-btn" id="playBtn" onclick="toggleMusic()">â–¶</button>
        <button class="control-btn next-btn" onclick="nextTrack()">â­</button>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ íš¨ê³¼ìŒ ê·¸ë£¹ -->
    <div class="effect-group">
      <button class="effect-button" onclick="toggleEffect('stream')">Stream</button>
      <button class="effect-button" onclick="toggleEffect('wind')">Wind</button>
      <button class="effect-button" onclick="toggleEffect('crackle')">Crackle</button>
      <button class="effect-button" onclick="toggleEffect('sand')">Sand</button>
    </div>
  </div>

  <!-- ë¹„ë””ì˜¤ ìš”ì†Œë“¤ -->
  <video id="loop1" muted>
    <source src="Loof_01.mp4" type="video/mp4" />
  </video>

  <video id="loop2" muted>
    <source src="Loof_01-1.mp4" type="video/mp4" />
  </video>

  <video id="overlayVideo" muted loop>
    <source src="overlay01.mp4" type="video/mp4" />
  </video>
<video id="introVideo" muted preload="auto" style="position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; object-fit: cover; z-index: 3; opacity: 0; transition: opacity 1s ease; mix-blend-mode: screen; pointer-events: none;">

  <source src="./02_video/Intro/Intro_video-á„†á…¦á†¯á„…á…©á„‚á…µ.mp4" type="video/mp4">
</video>



  <!-- ë¡œê³  ë¹„ë””ì˜¤ë“¤ -->
  <video id="logo1" muted preload="auto">
    <source src="Logo_Melony_1.m4v" type="video/mp4" />
  </video>

  <!-- ì˜¤ë””ì˜¤ ìš”ì†Œë“¤ -->
  <!-- ë®¤ì§ í”Œë ˆì´ì–´ -->
  <audio id="musicPlayer" preload="auto" crossorigin="anonymous">
    Your browser does not support the audio element.
  </audio>

  <!-- íš¨ê³¼ìŒ ì˜¤ë””ì˜¤ ìš”ì†Œë“¤ -->
  <audio id="effect-rain" src="pop_song/effect_Rain.m4a" loop preload="metadata"></audio>
  <audio id="effect-bird" src="pop_song/effect_Bird.m4a" loop preload="metadata"></audio>
  <audio id="effect-forest" src="pop_song/effect_Forest.m4a" loop preload="metadata"></audio>
  <audio id="effect-wind" src="pop_song/effect_Wind.m4a" loop preload="metadata"></audio>
  <audio id="effect-crackle" src="pop_song/effect_Crackle.m4a" loop preload="metadata"></audio>
  <audio id="effect-sand" src="pop_song/effect_Sand.m4a" loop preload="metadata"></audio>
  <audio id="effect-stream" src="pop_song/effect_Stream.m4a" loop preload="metadata"></audio>
  <audio id="effect-crickets" src="pop_song/effect_Crickets.m4a" loop preload="metadata"></audio>

    <!-- ğŸ”Š í´ë¦­ ì†Œë¦¬ ì˜¤ë””ì˜¤ ìš”ì†Œ -->
  <audio id="clickSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmAZNjRfnNn2TxA" type="audio/wav">
  </audio>

  <!-- ì‹œì‘ ë²„íŠ¼ -->
  <button id="startButton">ğŸµ ìŒì•… ì‹œì‘</button>

  <!-- ===== Melony.j ë¡œê³  HTML ===== -->
  <div class="logo-container">
    <div class="melony-logo" onclick="toggleControlCenter()">
      <div class="orbit orbit-1">
        <div class="planet planet-1"></div>
        <div class="planet planet-2"></div>
        <div class="planet planet-3"></div>
        <div class="planet planet-4"></div>
      </div>
      <div class="orbit orbit-2">
        <div class="planet planet-5"></div>
      </div>
      <div class="logo-text"></div>
    </div>
  </div>

  <!-- ì™¸ë¶€ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ íŒŒì¼ë“¤ -->
  <script>
    // ===== í™˜ê²½ ì„¤ì • =====
    const DEBUG = false; // í”„ë¡œë•ì…˜ì—ì„œëŠ” false

    // ===== CONFIG ìƒìˆ˜ =====
    const CONFIG = {
      OPACITY: {
        DEFAULT_OVERLAY: 0.2,
        DEFAULT_INTRO: 0.3,
        DEFAULT_PANEL: 0.3
      },

      TIMING: {
        FADE_SLOW: 1000,        // 1s
        FADE_MEDIUM: 500,       // 0.5s
        FADE_FAST: 300,         // 0.3s
        AUDIO_FADE: 500,
        LOADER_DELAY: 100
      },

      PATHS: {
        DEFAULT_INTRO: '02_video/Intro/ì¸íŠ¸ë¡œ.m4v',
        DEFAULT_LOOP1: 'Loof_01.mp4',
        DEFAULT_LOOP2: 'Loof_01-1.mp4',
        DEFAULT_OVERLAY: 'overlay01.mp4'
      },

      COLORS: {
        PRIMARY: '#4FC3F7',
        SUCCESS: '#4CAF50',
        ERROR: '#E57373',
        WARNING: '#FFB74D'
      }
    };

    // ===== Debug ë¡œê¹… í•¨ìˆ˜ =====
    function debugLog(...args) {
      if (DEBUG) console.log(...args);
    }


    // ===== DOM ìš”ì†Œ ìºì‹± ì‹œìŠ¤í…œ =====
    const DOM = {
      overlay: {},
      intro: {},
      loops: {},
      audio: {},
      ui: {},

      init() {
        // Overlay ìš”ì†Œë“¤
        this.overlay.video = document.getElementById('overlayVideo');
        this.overlay.enabled = document.getElementById('overlayEnabled');
        this.overlay.opacitySlider = document.getElementById('overlay-opacity-slider');
        this.overlay.opacityValue = document.getElementById('overlay-opacity-value');
        this.overlay.blendMode = document.getElementById('overlayBlendMode');
        this.overlay.fileStatus = document.getElementById('overlayFileStatus');
        this.overlay.applyBtn = document.getElementById('applyOverlayBtn');

        // Intro ìš”ì†Œë“¤
        this.intro.video = document.getElementById('introVideo');
        this.intro.enabled = document.getElementById('introEnabled');
        this.intro.opacitySlider = document.getElementById('intro-opacity-slider');
        this.intro.opacityValue = document.getElementById('intro-opacity-value');
        this.intro.blendMode = document.getElementById('introBlendMode');
        this.intro.fileStatus = document.getElementById('introFileStatus');
        this.intro.applyBtn = document.getElementById('applyIntroBtn');

        // ë£¨í”„ ë¹„ë””ì˜¤ë“¤
        this.loops.loop1 = document.getElementById('loop1');
        this.loops.loop2 = document.getElementById('loop2');

        // ì˜¤ë””ì˜¤ ìš”ì†Œë“¤
        this.audio.musicPlayer = document.getElementById('musicPlayer');

        // UI ìš”ì†Œë“¤
        this.ui.controlCenter = document.getElementById('controlCenter');
        this.ui.playlistDisplay = document.getElementById('playlistDisplay');
        this.ui.logDisplay = document.getElementById('logDisplay');

      }
    };

    // ===== í†µí•© ë¯¸ë””ì–´ ì œì–´ í•¨ìˆ˜ë“¤ (Overlay/Intro í†µí•©) =====

    // 1. adjustMediaOpacity - íˆ¬ëª…ë„ ì¡°ì ˆ í†µí•© í•¨ìˆ˜
    function adjustMediaOpacity(mediaType, opacity) {

      const video = DOM[mediaType].video;
      const enabled = DOM[mediaType].enabled;

      if (!video) { console.error(`âŒ ${mediaType} ë¹„ë””ì˜¤ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`); return; }

      const normalizedOpacity = opacity / 100;

      // overlayëŠ” í™œì„±í™” ìƒíƒœ ì²´í¬, introëŠ” í•­ìƒ ì ìš©
      if (mediaType === 'overlay' && enabled && !enabled.checked) {
        video.style.opacity = '0';
      } else {
        video.style.transition = `opacity ${CONFIG.TIMING.FADE_FAST}ms ease`; video.style.opacity = normalizedOpacity;
      }
    }

    // 2. toggleMedia - ë¯¸ë””ì–´ í™œì„±í™”/ë¹„í™œì„±í™” í†µí•© í•¨ìˆ˜
    function toggleMedia(mediaType) {
      const video = DOM[mediaType].video;
      const enabled = DOM[mediaType].enabled;
      const opacitySlider = DOM[mediaType].opacitySlider;

      if (!video || !enabled) return;

      const emoji = mediaType === 'overlay' ? 'ğŸ­' : 'ğŸ¬';

      if (enabled.checked) {
        // í™œì„±í™”
        const opacityValue = opacitySlider ? parseInt(opacitySlider.value) : 20;

        video.style.transition = 'opacity 1s ease';
        adjustMediaOpacity(mediaType, opacityValue);

        if (video.paused && video.src) {
          video.currentTime = 0;
          video.play().catch(error => {
            console.error(`${mediaType} ì¬ìƒ ì‹¤íŒ¨:`, error);
          });
        }

        if (isControlCenterMode) {
          addLog('info', `${emoji} ${mediaType} í™œì„±í™” (íˆ¬ëª…ë„: ${opacityValue}%)`);
        }
      } else {
        // ë¹„í™œì„±í™”
        video.style.transition = `opacity ${CONFIG.TIMING.FADE_SLOW}ms ease`;
        video.style.opacity = '0';

        // introëŠ” ì¬ìƒ ì¤‘ì´ë©´ í˜ì´ë“œì•„ì›ƒ í›„ ì •ì§€
        if (mediaType === 'intro' && !video.paused) {
          setTimeout(() => {
            video.pause();
            video.currentTime = 0;
          }, 1000);
        }

        if (isControlCenterMode) {
          addLog('info', `${emoji} ${mediaType} ë¹„í™œì„±í™”`);
        }
      }
    }

    // 3. previewMediaOpacity - íˆ¬ëª…ë„ ë¯¸ë¦¬ë³´ê¸° í†µí•© í•¨ìˆ˜
    function previewMediaOpacity(mediaType, opacity) {

      const valueElement = DOM[mediaType].opacityValue;
      const emoji = mediaType === 'overlay' ? 'ğŸ­' : 'ğŸ¬';

      // ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸
      if (valueElement) {
        valueElement.textContent = `${opacity}%`;
        valueElement.style.color = CONFIG.COLORS.PRIMARY;
      } else {
        console.error(`âŒ ${mediaType}-opacity-value ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
      }

      // ì‹¤ì‹œê°„ íˆ¬ëª…ë„ ì ìš©
      adjustMediaOpacity(mediaType, opacity);

      // ë¡œê·¸ ê¸°ë¡
      if (isControlCenterMode) {
        addLog('info', `${emoji} ${mediaType} íˆ¬ëª…ë„: ${opacity}%`);
      }

    }

    // 4. changeMediaBlendMode - ë¸”ë Œë“œ ëª¨ë“œ ë³€ê²½ í†µí•© í•¨ìˆ˜
    function changeMediaBlendMode(mediaType, blendMode) {
      const video = DOM[mediaType].video;
      const emoji = mediaType === 'overlay' ? 'ğŸ­' : 'ğŸ¬';

      if (!video) return;

      video.style.mixBlendMode = blendMode;

      if (isControlCenterMode) {
        addLog('info', `${mediaType} ë¸”ë Œë“œ ëª¨ë“œ: ${blendMode}`);
      }
    }

    // 5. createOpacityHandler - íˆ¬ëª…ë„ ë³€ê²½ í•¸ë“¤ëŸ¬ ìƒì„± í•¨ìˆ˜
    function createOpacityHandler(mediaType) {
      return function(e) {
        const opacity = parseInt(e.target.value);
        previewMediaOpacity(mediaType, opacity);
      };
    }

    // 6. createBlendModeHandler - ë¸”ë Œë“œ ëª¨ë“œ ë³€ê²½ í•¸ë“¤ëŸ¬ ìƒì„± í•¨ìˆ˜
    function createBlendModeHandler(mediaType) {
      return function(e) {
        changeMediaBlendMode(mediaType, e.target.value);
      };
    }

    // 7. setupMediaControls - ë¯¸ë””ì–´ ì»¨íŠ¸ë¡¤ ì„¤ì • í†µí•© í•¨ìˆ˜
    function setupMediaControls(mediaType) {
      const emoji = mediaType === 'overlay' ? 'ğŸ­' : 'ğŸ¬';

      const opacitySlider = DOM[mediaType].opacitySlider;
      const blendMode = DOM[mediaType].blendMode;
      const enabled = DOM[mediaType].enabled;

      // íˆ¬ëª…ë„ ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸
      if (opacitySlider) {
        const opacityHandler = (e) => {
          const opacity = parseInt(e.target.value);
            previewMediaOpacity(mediaType, opacity);
        };

        // ê¸°ì¡´ í•¸ë“¤ëŸ¬ê°€ ìˆìœ¼ë©´ ì œê±°í•˜ê¸° ìœ„í•´ ë°ì´í„° ì†ì„±ì— ì €ì¥
        if (opacitySlider._opacityHandler) {
          opacitySlider.removeEventListener('input', opacitySlider._opacityHandler);
        }
        opacitySlider._opacityHandler = opacityHandler;
        opacitySlider.addEventListener('input', opacityHandler);


        // ì´ˆê¸°ê°’ ì„¤ì •
        const initialOpacity = parseInt(opacitySlider.value);
        previewMediaOpacity(mediaType, initialOpacity);
      } else {
        console.error('âŒ íˆ¬ëª…ë„ ìŠ¬ë¼ì´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }

      // ë¸”ë Œë“œ ëª¨ë“œ ì´ë²¤íŠ¸
      if (blendMode) {
        const blendModeHandler = (e) => {
            changeMediaBlendMode(mediaType, e.target.value);
        };

        if (blendMode._blendModeHandler) {
          blendMode.removeEventListener('change', blendMode._blendModeHandler);
        }
        blendMode._blendModeHandler = blendModeHandler;
        blendMode.addEventListener('change', blendModeHandler);


        // ì´ˆê¸°ê°’ ì„¤ì •
        changeMediaBlendMode(mediaType, blendMode.value);
      } else {
        console.error('âŒ ë¸”ë Œë“œ ëª¨ë“œ ì…€ë ‰íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }

      // í™œì„±í™” í† ê¸€ ì´ë²¤íŠ¸
      if (enabled) {
        const toggleHandler = () => toggleMedia(mediaType);

        if (enabled._toggleHandler) {
          enabled.removeEventListener('change', enabled._toggleHandler);
        }
        enabled._toggleHandler = toggleHandler;
        enabled.addEventListener('change', toggleHandler);

      } else {
        console.error('âŒ í™œì„±í™” ì²´í¬ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
      }

    }

    // ğŸ¬ ì¸íŠ¸ë¡œ URL ìµœìš°ì„  ì„¤ì •
    window.introVideoUrl = CONFIG.PATHS.DEFAULT_INTRO;

    // ===== ì»¨íŠ¸ë¡¤ ì„¼í„° ê´€ë ¨ ë³€ìˆ˜ë“¤ =====
    let isControlCenterMode = false;
    let selectedPlaylists = ['pop2'];

    // ìŠ¤í…”ìŠ¤ ëª¨ë“œ ê´€ë ¨ ë³€ìˆ˜ë“¤
    let stealthSettings = {
      panelOpacity: CONFIG.OPACITY.DEFAULT_PANEL,
      buttonOpacity: 1.0,
      blurAmount: 20,
      hoverEnabled: true,
      isActive: false
    };

       // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ë£¨í”„ ì˜ìƒë“¤
    let currentLoopVideos = {
      loop1: 'Loof_01.mp4',
      loop2: 'Loof_01-1.mp4'
    };

    // ë¡œë“œëœ ë°°ê²½ ë¯¸ë””ì–´ (ì´ë¯¸ì§€/ì˜ìƒ) ëª©ë¡
    let loadedBackgroundMedia = [
      { name: 'ê¸°ë³¸ ë£¨í”„ ì˜ìƒ', type: 'video', loop1: 'Loof_01.mp4', loop2: 'Loof_01-1.mp4' }
    ];


    // ë°°ê²½ ì´ë¯¸ì§€ ê¸°ë³¸ ëª©ë¡
    const defaultBackgroundImages = [
      { name: 'ì‚°', type: 'image', url: 'https://images.unsplash.com/photo-1506197603052-3cc9c3a201bd?w=1920&h=1080&fit=crop' },
      { name: 'ë°”ë‹¤', type: 'image', url: 'https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=1920&h=1080&fit=crop' },
      { name: 'ìˆ²', type: 'image', url: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1920&h=1080&fit=crop' },
      { name: 'ë„ì‹œ', type: 'image', url: 'https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?w=1920&h=1080&fit=crop' },
      { name: 'ì¸ë¬¼', type: 'image', url: 'https://images.unsplash.com/photo-1494790108755-2616c90735c0?w=1920&h=1080&fit=crop' }
    ];

    // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ëª©ë¡ (ì‹¤ì œ ë°ì´í„°ì™€ ì—°ê²°)
    let loadedPlaylists = [
      { id: 'default', name: 'ê¸°ë³¸ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸', tracks: [] }
    ];

    // ë°©ì†¡ìš© í†µí•© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸
    let broadcastPlaylist = [];

    // íš¨ê³¼ìŒ ëª©ë¡
    const effectSounds = ['rain', 'bird', 'forest', 'crickets', 'stream', 'wind', 'crackle', 'sand'];
    let effectVolumes = {};

    // í”„ë¦¬ì…‹ ê´€ë¦¬ ê´€ë ¨ ë³€ìˆ˜ë“¤
    let savedPresets = {};

    // ===== ë“œë˜ê·¸ì•¤ë“œë¡­ ë° íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨ í•¨ìˆ˜ë“¤ =====
    
    // ë“œë˜ê·¸ì•¤ë“œë¡­ ì´ë²¤íŠ¸ ì„¤ì •
    function setupDragAndDrop() {
      // ë°°ê²½ ì—…ë¡œë“œ ì¡´
      const backgroundZone = document.getElementById('backgroundUploadZone');
      if (backgroundZone) {
        setupUploadZone(backgroundZone, handleBackgroundFiles);
      }

      // ì˜¤ë²„ë ˆì´ ì—…ë¡œë“œ ì¡´
      const overlayZone = document.getElementById('overlayUploadZone');
      if (overlayZone) {
        setupUploadZone(overlayZone, handleOverlayFiles);
      }

      // ì¸íŠ¸ë¡œ ì—…ë¡œë“œ ì¡´
      const introZone = document.getElementById('introUploadZone');
      if (introZone) {
        setupUploadZone(introZone, handleIntroFiles);
      }
    }

    // ì—…ë¡œë“œ ì¡´ ì„¤ì • í•¨ìˆ˜
    function setupUploadZone(zone, handler) {
      // ë“œë˜ê·¸ ì´ë²¤íŠ¸ë“¤
      zone.addEventListener('dragover', (e) => {
        e.preventDefault();
        zone.classList.add('drag-over');
      });

      zone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        zone.classList.remove('drag-over');
      });

      zone.addEventListener('drop', (e) => {
        e.preventDefault();
        zone.classList.remove('drag-over');
        const files = Array.from(e.dataTransfer.files);
        handler(files);
      });

      // í´ë¦­ìœ¼ë¡œ íŒŒì¼ ì„ íƒ
      zone.addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.multiple = true;
        input.accept = getAcceptAttribute(zone.id);
        input.addEventListener('change', (e) => {
          const files = Array.from(e.target.files);
          handler(files);
        });
        input.click();
      });
    }

    // ì—…ë¡œë“œ ì¡´ë³„ íŒŒì¼ íƒ€ì… ì„¤ì •
    function getAcceptAttribute(zoneId) {
      switch(zoneId) {
        case 'backgroundUploadZone':
          return 'image/*,video/*';
        case 'overlayUploadZone':
          return 'video/*,.png,.mov,.mp4';
        case 'introUploadZone':
          return 'video/*,.mp4,.mov';
        default:
          return '*/*';
      }
    }

    // ë°°ê²½ íŒŒì¼ ì²˜ë¦¬
    function handleBackgroundFiles(files) {
      console.log('ğŸ–¼ï¸ handleBackgroundFiles í˜¸ì¶œ, íŒŒì¼:', files);
      
      const imageFiles = files.filter(file => file.type.startsWith('image/'));
      const videoFiles = files.filter(file => file.type.startsWith('video/'));
      
      console.log('ì´ë¯¸ì§€:', imageFiles.length, 'ë¹„ë””ì˜¤:', videoFiles.length);
      
      addLog('info', `ë°°ê²½ íŒŒì¼ ì—…ë¡œë“œ: ì´ë¯¸ì§€ ${imageFiles.length}ê°œ, ë¹„ë””ì˜¤ ${videoFiles.length}ê°œ`);
      
      // ì´ë¯¸ì§€ íŒŒì¼ë“¤ ì²˜ë¦¬
      imageFiles.forEach(file => {
        const url = URL.createObjectURL(file);
        loadedBackgroundMedia.push({
          name: file.name,
          type: 'image',
          url: url
        });
        addLog('info', `ì´ë¯¸ì§€ ì¶”ê°€: ${file.name}`);
      });
      
      // ë¹„ë””ì˜¤ íŒŒì¼ ì²˜ë¦¬
      videoFiles.forEach(video => {
        const url = URL.createObjectURL(video);
        console.log('ğŸ“¹ ë¹„ë””ì˜¤ URL ìƒì„±:', url);

        loadedBackgroundMedia.push({
          name: video.name,
          type: 'video',
          loop1: url,
          loop2: url
        });
        addLog('info', `ë¹„ë””ì˜¤ ì¶”ê°€: ${video.name}`);
      });
      
      updateBackgroundSelector();
      
      // ë§ˆì§€ë§‰ ì¶”ê°€ëœ ë¹„ë””ì˜¤ë¥¼ ìë™ìœ¼ë¡œ ì ìš©
      if (videoFiles.length > 0) {
        const lastIndex = loadedBackgroundMedia.length - 1;
        console.log('ğŸ¬ ìë™ ì ìš©, ì¸ë±ìŠ¤:', lastIndex);
        setTimeout(() => {
          applyBackgroundMedia('loaded', lastIndex);
        }, 500);
      }
      
      // ì´ë¯¸ì§€ë§Œ ìˆìœ¼ë©´ ì´ë¯¸ì§€ ì ìš©
      if (imageFiles.length > 0 && videoFiles.length === 0) {
        const lastIndex = loadedBackgroundMedia.length - 1;
        setTimeout(() => {
          applyBackgroundMedia('loaded', lastIndex);
        }, 500);
      }
    }

        // ì˜¤ë²„ë ˆì´ íŒŒì¼ ì²˜ë¦¬
    function handleOverlayFiles(files) {
      const videoFiles = files.filter(file =>
        file.type.startsWith('video/') ||
        file.name.toLowerCase().endsWith('.mov') ||
        file.name.toLowerCase().endsWith('.mp4')
      );

      if (videoFiles.length > 0) {
        const file = videoFiles[0]; // ì²« ë²ˆì§¸ íŒŒì¼ë§Œ ì‚¬ìš©
        const url = URL.createObjectURL(file);

        // ğŸ”§ ìˆ˜ì •: window.pendingOverlayFileì— ì €ì¥
        window.pendingOverlayFile = {
          url: url,
          name: file.name
        };

        // ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
        const statusElement = document.getElementById('overlayFileStatus');
        const applyBtn = document.getElementById('applyOverlayBtn');

        if (statusElement) {
          statusElement.textContent = `ì„ íƒë¨: ${file.name}`;
          statusElement.style.color = '#4FC3F7';
        }

        if (applyBtn) {
          applyBtn.disabled = false;
          applyBtn.style.background = 'linear-gradient(135deg, #4CAF50, #66BB6A)';
          applyBtn.textContent = 'ì˜¤ë²„ë ˆì´ ì ìš©';
        }

        addLog('info', `ì˜¤ë²„ë ˆì´ íŒŒì¼ ì„ íƒ: ${file.name}`);
      } else {
        addLog('error', 'ì§€ì›ë˜ì§€ ì•ŠëŠ” ì˜¤ë²„ë ˆì´ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤');
      }
    }

    // ì¸íŠ¸ë¡œ íŒŒì¼ ì²˜ë¦¬
    function handleIntroFiles(files) {
      const videoFiles = files.filter(file => 
        file.type.startsWith('video/') || 
        file.name.toLowerCase().endsWith('.mov') ||
        file.name.toLowerCase().endsWith('.mp4')
      );
      
      if (videoFiles.length > 0) {
        const file = videoFiles[0];
        const url = URL.createObjectURL(file);
        
        // ì¸íŠ¸ë¡œ ë¹„ë””ì˜¤ ì €ì¥ (ë‚˜ì¤‘ì— êµ¬í˜„)
        window.introVideoUrl = url;
        addLog('info', `ì¸íŠ¸ë¡œ ë¹„ë””ì˜¤ ì„¤ì •: ${file.name}`);
      } else {
        addLog('error', 'ì§€ì›ë˜ì§€ ì•ŠëŠ” ì¸íŠ¸ë¡œ íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤');
      }
    }
    
    // ì¸íŠ¸ë¡œ ì ìš© í•¨ìˆ˜
    function applyIntro() {
      if (!window.pendingIntroFile) {
        addLog('error', 'ì„ íƒëœ ì¸íŠ¸ë¡œ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      // ì¸íŠ¸ë¡œ ë¹„ë””ì˜¤ ì „ì—­ ì €ì¥
      window.introVideoUrl = window.pendingIntroFile.url;
      window.introVideoName = window.pendingIntroFile.name;

      
      // ìƒíƒœ ì—…ë°ì´íŠ¸
      const statusElement = document.getElementById('introFileStatus');
      const applyBtn = document.getElementById('applyIntroBtn');
      const introEnabled = document.getElementById('introEnabled');
      
      if (statusElement) {
        statusElement.textContent = `í˜„ì¬: ${window.pendingIntroFile.name}`;
        statusElement.style.color = '#4CAF50';
      }
      
      if (applyBtn) {
        applyBtn.disabled = true;
        applyBtn.style.background = '#666';
        applyBtn.textContent = 'ì ìš©ë¨';
      }
      
      // ì¸íŠ¸ë¡œ í™œì„±í™” ì²´í¬ë°•ìŠ¤ë„ ìë™ìœ¼ë¡œ ì²´í¬
      if (introEnabled) {
        introEnabled.checked = true;
      }
      
      addLog('info', `ì¸íŠ¸ë¡œ ì ìš© ì™„ë£Œ: ${window.pendingIntroFile.name}`);
      
      // ì„ì‹œ íŒŒì¼ ì •ë³´ ì œê±°
      window.pendingIntroFile = null;
    }

// ì¸íŠ¸ë¡œ ì¬ìƒ í•¨ìˆ˜ (ì¸íŠ¸ë¡œì™€ ë©”ì¸ ë£¨í”„ê°€ ë™ì‹œì— ì¬ìƒ)
function playIntroVideo() {
    const introVideo = document.getElementById('introVideo');

        // ê¸°ë³¸ ì¸íŠ¸ë¡œ íŒŒì¼ì´ ì„¤ì •ë˜ì–´ ìˆìœ¼ë©´ í•´ë‹¹ íŒŒì¼ ì‚¬ìš©
    const introUrl = window.introVideoUrl || '02_video/Intro/ì¸íŠ¸ë¡œ.m4v';
    
    if (!introVideo || !window.introVideoUrl) {
        addLog('error', 'ì¸íŠ¸ë¡œ ë¹„ë””ì˜¤ ìš”ì†Œê°€ ì—†ê±°ë‚˜ íŒŒì¼ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
        return;
    }
    
    addLog('info', 'ğŸ¬ ì¸íŠ¸ë¡œì™€ ë©”ì¸ ë£¨í”„ ë™ì‹œ ì¬ìƒ ì¤€ë¹„');
    
// ğŸ†• ë°°ê²½ íƒ€ì…ì— ë”°ë¼ ë©”ì¸ ë£¨í”„ ì¬ìƒ ê²°ì •
    const loop1 = document.getElementById('loop1');
    const loop2 = document.getElementById('loop2');
    
    try {
        const backgroundTypeElement = document.querySelector('input[name="backgroundType"]:checked');
        const backgroundType = backgroundTypeElement ? backgroundTypeElement.value : 'video';
        
        if (backgroundType === 'video' && loop1 && loop2) {
            // ë¹„ë””ì˜¤ ëª¨ë“œì¼ ë•Œë§Œ ë©”ì¸ ë£¨í”„ ì¬ìƒ
            playLoop(loop1, loop2);
        } else {
            // ì´ë¯¸ì§€ ëª¨ë“œì¼ ë•ŒëŠ” ë©”ì¸ ë£¨í”„ ì¬ìƒ ì•ˆí•¨
        }
    } catch (error) {
        // ì—ëŸ¬ ë°œìƒ ì‹œ ê¸°ë³¸ì ìœ¼ë¡œ ë£¨í”„ ì¬ìƒ
        console.error('ë°°ê²½ íƒ€ì… í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
        if (loop1 && loop2) {
            playLoop(loop1, loop2);
        }
    }

    // ì¸íŠ¸ë¡œ ì˜ìƒ ì†ŒìŠ¤ ì„¤ì •
    introVideo.src = window.introVideoUrl;
    
    // ë¡œë“œ ì™„ë£Œ í›„ ì¬ìƒ ì‹œì‘
    introVideo.addEventListener('loadeddata', function onLoaded() {
        introVideo.removeEventListener('loadeddata', onLoaded);
        
        // ì¸íŠ¸ë¡œ ì˜ìƒ ì¬ìƒ ë° í˜ì´ë“œì¸
        introVideo.play().then(() => {
            introVideo.style.opacity = '1';
            addLog('info', 'ğŸ¬ ì¸íŠ¸ë¡œ ì¬ìƒ ì‹œì‘ (ë©”ì¸ ì˜ìƒê³¼ ì˜¤ë²„ë ˆì´)');

            // ì¸íŠ¸ë¡œ ì˜ìƒì´ ëë‚˜ë©´ í˜ì´ë“œ ì•„ì›ƒ
            introVideo.onended = () => {
                introVideo.style.opacity = '0';
                addLog('info', 'ğŸ¬ ì¸íŠ¸ë¡œ ì¬ìƒ ì¢…ë£Œ');
            };

        }).catch(error => {
            addLog('error', `ì¸íŠ¸ë¡œ ì¬ìƒ ì‹¤íŒ¨: ${error.message}`);
        });

    }, { once: true });
    
    introVideo.load();
}
    // ===== í”„ë¦¬ì…‹ ê´€ë¦¬ í•¨ìˆ˜ë“¤ =====
    
    // í”„ë¦¬ì…‹ ì €ì¥
    function savePreset() {
      const presetName = document.getElementById('presetName').value.trim();
      if (!presetName) {
        addLog('error', 'í”„ë¦¬ì…‹ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return;
      }
      
      const preset = {
        name: presetName,
        timestamp: new Date().toISOString(),
        settings: {
          // EQ ì„¤ì •
          eqLow: document.getElementById('eqLowSlider')?.value || 4,
          eqMid: document.getElementById('eqMidSlider')?.value || 2.5,
          eqHigh: document.getElementById('eqHighSlider')?.value || -2,
          
          // ë³¼ë¥¨ ì„¤ì •
          masterVolume: document.getElementById('master-volume-slider-main')?.value || 50,
          effectVolumes: {...effectVolumes},
          
          // ìŠ¤í…”ìŠ¤ ëª¨ë“œ ì„¤ì •
          stealthSettings: {...stealthSettings},
          
          // ë°°ê²½ ë° ì˜¤ë²„ë ˆì´ ì„¤ì •
          backgroundType: document.querySelector('input[name="backgroundType"]:checked')?.value || 'image',
          overlayEnabled: document.getElementById('overlayEnabled')?.checked || true,
          introEnabled: document.getElementById('introEnabled')?.checked || false,
          
          // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì„¤ì •
          selectedPlaylists: [...selectedPlaylists],
          isShuffleMode: isShuffleMode
        }
      };
      
      savedPresets[presetName] = preset;
      updatePresetList();
      document.getElementById('presetName').value = '';
      addLog('info', `í”„ë¦¬ì…‹ ì €ì¥: ${presetName}`);
    }

    // í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadPreset() {
      const presetName = document.getElementById('presetName').value.trim();
      if (!presetName || !savedPresets[presetName]) {
        addLog('error', 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í”„ë¦¬ì…‹ì…ë‹ˆë‹¤');
        return;
      }
      
      const preset = savedPresets[presetName];
      const settings = preset.settings;
      
      // EQ ì„¤ì • ì ìš©
      if (document.getElementById('eqLowSlider')) {
        document.getElementById('eqLowSlider').value = settings.eqLow;
        document.getElementById('eqLowValue').textContent = settings.eqLow + 'dB';
      }
      if (document.getElementById('eqMidSlider')) {
        document.getElementById('eqMidSlider').value = settings.eqMid;
        document.getElementById('eqMidValue').textContent = settings.eqMid + 'dB';
      }
      if (document.getElementById('eqHighSlider')) {
        document.getElementById('eqHighSlider').value = settings.eqHigh;
        document.getElementById('eqHighValue').textContent = settings.eqHigh + 'dB';
      }
      
      // ë³¼ë¥¨ ì„¤ì • ì ìš©
      if (document.getElementById('master-volume-slider-main')) {
        document.getElementById('master-volume-slider-main').value = settings.masterVolume;
        document.getElementById('master-volume-value-main').textContent = settings.masterVolume + '%';
        audioManager.setBaseVolume(settings.masterVolume / 100);
      }
      
      // íš¨ê³¼ìŒ ë³¼ë¥¨ ì ìš©
      effectVolumes = {...settings.effectVolumes};
      
      // ìŠ¤í…”ìŠ¤ ëª¨ë“œ ì ìš©
      stealthSettings = {...settings.stealthSettings};
      if (stealthSettings.isActive) {
        applyStealthMode(stealthSettings.panelOpacity, stealthSettings.buttonOpacity, stealthSettings.blurAmount, stealthSettings.hoverEnabled);
      }
      
      // ê¸°íƒ€ ì„¤ì • ì ìš©
      if (document.querySelector(`input[name="backgroundType"][value="${settings.backgroundType}"]`)) {
        document.querySelector(`input[name="backgroundType"][value="${settings.backgroundType}"]`).checked = true;
      }
      if (document.getElementById('overlayEnabled')) {
        document.getElementById('overlayEnabled').checked = settings.overlayEnabled;
      }
      if (document.getElementById('introEnabled')) {
        document.getElementById('introEnabled').checked = settings.introEnabled;
      }
      
      // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì„¤ì • ì ìš©
      selectedPlaylists = [...settings.selectedPlaylists];
      if (settings.isShuffleMode !== isShuffleMode) {
        toggleShuffle();
      }
      
      // UI ì—…ë°ì´íŠ¸
      if (isControlCenterMode) {
        updateControlCenterInfo();
      }
      
      addLog('info', `í”„ë¦¬ì…‹ ë¶ˆëŸ¬ì˜¤ê¸°: ${presetName}`);
    }

    // í”„ë¦¬ì…‹ ì‚­ì œ
    function deletePreset() {
      const presetName = document.getElementById('presetName').value.trim();
      if (!presetName || !savedPresets[presetName]) {
        addLog('error', 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í”„ë¦¬ì…‹ì…ë‹ˆë‹¤');
        return;
      }
      
      delete savedPresets[presetName];
      updatePresetList();
      document.getElementById('presetName').value = '';
      addLog('info', `í”„ë¦¬ì…‹ ì‚­ì œ: ${presetName}`);
    }

    // í”„ë¦¬ì…‹ ë‚´ë³´ë‚´ê¸°
    function exportPreset() {
      const presetName = document.getElementById('presetName').value.trim();
      if (!presetName || !savedPresets[presetName]) {
        addLog('error', 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” í”„ë¦¬ì…‹ì…ë‹ˆë‹¤');
        return;
      }
      
      const preset = savedPresets[presetName];
      const dataStr = JSON.stringify(preset, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      
      const link = document.createElement('a');
      link.href = URL.createObjectURL(dataBlob);
      link.download = `preset_${presetName}.json`;
      link.click();
      
      addLog('info', `í”„ë¦¬ì…‹ ë‚´ë³´ë‚´ê¸°: ${presetName}.json`);
    }

    // í”„ë¦¬ì…‹ ëª©ë¡ ì—…ë°ì´íŠ¸
    function updatePresetList() {
      const presetList = document.getElementById('presetList');
      if (!presetList) return;
      
      presetList.innerHTML = '';
      
      if (Object.keys(savedPresets).length === 0) {
        presetList.innerHTML = '<div style="color: #90A4AE; text-align: center;">ì €ì¥ëœ í”„ë¦¬ì…‹ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }
      
      Object.keys(savedPresets).forEach(name => {
        const preset = savedPresets[name];
        const presetItem = document.createElement('div');
        presetItem.style.cssText = 'padding: 5px; margin: 2px 0; background: rgba(255,255,255,0.05); border-radius: 3px; cursor: pointer; display: flex; justify-content: space-between; align-items: center;';
        
        presetItem.innerHTML = `
          <span onclick="document.getElementById('presetName').value='${name}'">${name}</span>
          <span style="font-size: 9px; color: #90A4AE;">${new Date(preset.timestamp).toLocaleDateString()}</span>
        `;
        
        presetList.appendChild(presetItem);
      });
    }

    // ì˜¤ë””ì˜¤ í˜ì´ë“œ í•¨ìˆ˜ë“¤
    function fadeInAudio(audioElement, duration = CONFIG.TIMING.AUDIO_FADE) {
      return new Promise((resolve) => {
        audioElement.volume = 0;
        const target = audioManager.baseVolume;
        const steps = 20, stepDuration = duration / steps, volumeStep = target / steps;
        let currentStep = 0;
        const fadeInterval = setInterval(() => {
          currentStep++;
          audioElement.volume = Math.max(0, Math.min(1, Math.min(volumeStep * currentStep, target)));
          if (currentStep >= steps) { clearInterval(fadeInterval); audioElement.volume = target; resolve(); }
        }, stepDuration);
      });
    }

    function fadeOutAudio(audioElement, duration = CONFIG.TIMING.AUDIO_FADE) {
      return new Promise((resolve) => {
        const startVolume = audioElement.volume, steps = 20, stepDuration = duration / steps, volumeStep = startVolume / steps;
        let currentStep = 0;
        const fadeInterval = setInterval(() => {
          currentStep++;
          audioElement.volume = Math.max(0, startVolume - (volumeStep * currentStep));
          if (currentStep >= steps || audioElement.volume <= 0) { clearInterval(fadeInterval); audioElement.volume = 0; resolve(); }
        }, stepDuration);
      });
    }

    // ë¡œê·¸ í•¨ìˆ˜
    function addLog(type, message) {
      const logDisplay = document.getElementById('logDisplay');
      if (!logDisplay) return;
      
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = document.createElement('div');
      logEntry.className = `log-entry ${type}`;
      logEntry.textContent = `[${timestamp}] ${message}`;
      
      logDisplay.appendChild(logEntry);
      logDisplay.scrollTop = logDisplay.scrollHeight;
      
      // ë¡œê·¸ í•­ëª©ì´ ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
      const logEntries = logDisplay.children;
      if (logEntries.length > 50) {
        logDisplay.removeChild(logEntries[0]);
      }
    }

    // ===== ìŠ¤í…”ìŠ¤ ëª¨ë“œ ì™„ì „ êµ¬í˜„ =====
    
    // ìŠ¤í…”ìŠ¤ ëª¨ë“œ ì ìš© í•¨ìˆ˜ - ë¸”ëŸ¬ íš¨ê³¼ê¹Œì§€ ì™„ë²½ ì œì–´
    function applyStealthMode(panelOpacity, buttonOpacity, blurAmount, hoverEnabled = true) {
      const panel = document.getElementById('controlPanel');
      if (!panel) {
        addLog('error', 'ì»¨íŠ¸ë¡¤ íŒ¨ë„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      // ëª¨ë“  ë²„íŠ¼ ìš”ì†Œë“¤ ì°¾ê¸° (í”Œë ˆì´ ë²„íŠ¼ í¬í•¨)
      const allButtons = panel.querySelectorAll('.effect-button, .control-btn, .play-btn, button');
      
      // ìŠ¤í…”ìŠ¤ ì„¤ì • ì €ì¥
      stealthSettings = {
        panelOpacity,
        buttonOpacity,
        blurAmount,
        hoverEnabled,
        isActive: true
      };
      
      // íŒ¨ë„ ìŠ¤íƒ€ì¼ ì ìš© (ë¸”ëŸ¬ íš¨ê³¼ í¬í•¨)
      panel.style.background = `rgba(243, 208, 147, ${panelOpacity})`;
      panel.style.border = `1px solid rgba(255, 255, 255, ${panelOpacity * 0.5})`;
      panel.style.backdropFilter = `blur(${blurAmount}px)`;
      
      // ê·¸ë¦¼ì íš¨ê³¼ ì¡°ì ˆ
      if (panelOpacity < 0.1) {
        panel.style.boxShadow = 'none';
      } else {
        panel.style.boxShadow = `0 12px 40px rgba(0, 0, 0, ${panelOpacity * 0.5})`;
      }
      
      // ëª¨ë“  ë²„íŠ¼ë“¤ì— íˆ¬ëª…ë„ ì ìš© (í”Œë ˆì´ ë²„íŠ¼ í¬í•¨)
      allButtons.forEach(btn => {
        btn.style.opacity = buttonOpacity;
        btn.style.color = `rgba(255, 255, 255, ${buttonOpacity})`;
        
        // í”Œë ˆì´ ë²„íŠ¼ì˜ ê²½ìš° ë°°ê²½ìƒ‰ë„ ì¡°ì ˆ
        if (btn.classList.contains('play-btn')) {
          const originalBg = btn.style.background || 'linear-gradient(135deg, #f093fb, #f5576c)';
          btn.style.background = originalBg;
          btn.style.filter = `opacity(${buttonOpacity})`;
        }
        
        // íš¨ê³¼ìŒ ë²„íŠ¼ë“¤ì˜ ë°°ê²½ë„ ì¡°ì ˆ
        if (btn.classList.contains('effect-button')) {
          btn.style.background = `linear-gradient(135deg, rgba(255, 255, 255, ${0.25 * buttonOpacity}), rgba(255, 255, 255, ${0.15 * buttonOpacity}))`;
          btn.style.border = `1px solid rgba(255, 255, 255, ${0.2 * buttonOpacity})`;
        }
        
        // ì»¨íŠ¸ë¡¤ ë²„íŠ¼ë“¤ì˜ ë°°ê²½ë„ ì¡°ì ˆ
        if (btn.classList.contains('control-btn') && !btn.classList.contains('play-btn')) {
          btn.style.background = `linear-gradient(135deg, rgba(255, 255, 255, ${0.2 * buttonOpacity}), rgba(255, 255, 255, ${0.1 * buttonOpacity}))`;
          btn.style.border = `1px solid rgba(255, 255, 255, ${0.3 * buttonOpacity})`;
        }
      });
      
      // í˜¸ë²„ íš¨ê³¼ ì„¤ì •
      if (hoverEnabled) {
        // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
        panel.onmouseenter = null;
        panel.onmouseleave = null;
        
        panel.addEventListener('mouseenter', () => {
          panel.style.background = 'rgba(243, 208, 147, 0.8)';
          panel.style.border = '1px solid rgba(255, 255, 255, 0.6)';
          panel.style.backdropFilter = 'blur(20px)';
          panel.style.boxShadow = '0 12px 40px rgba(0, 0, 0, 0.4)';
          
          allButtons.forEach(btn => {
            btn.style.opacity = '1';
            btn.style.color = 'white';
            
            if (btn.classList.contains('play-btn')) {
              btn.style.filter = 'opacity(1)';
            }
            
            if (btn.classList.contains('effect-button')) {
              btn.style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15))';
              btn.style.border = '1px solid rgba(255, 255, 255, 0.2)';
            }
            
            if (btn.classList.contains('control-btn') && !btn.classList.contains('play-btn')) {
              btn.style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1))';
              btn.style.border = '1px solid rgba(255, 255, 255, 0.3)';
            }
          });
        });
        
        panel.addEventListener('mouseleave', () => {
          applyStealthMode(stealthSettings.panelOpacity, stealthSettings.buttonOpacity, stealthSettings.blurAmount, false);
        });
      }
      
      const mode = panelOpacity < 0.1 ? 'ë‹Œì' : panelOpacity < 0.3 ? 'ê³ ìŠ¤íŠ¸' : 'ì»¤ìŠ¤í…€';
      addLog('info', `ğŸ‘» ìŠ¤í…”ìŠ¤ ëª¨ë“œ ì ìš©: ${mode} (íŒ¨ë„: ${Math.round(panelOpacity*100)}%, ë²„íŠ¼: ${Math.round(buttonOpacity*100)}%, ë¸”ëŸ¬: ${blurAmount}px)`);
    }
    
    // ìŠ¤í…”ìŠ¤ ëª¨ë“œ í”„ë¦¬ì…‹ ì ìš© í•¨ìˆ˜
    function applyStealthPreset(preset) {
      const panelSlider = document.getElementById('stealth-panel-slider');
      const buttonSlider = document.getElementById('stealth-button-slider');
      const blurSlider = document.getElementById('stealth-blur-slider');
      const hoverCheckbox = document.getElementById('stealth-hover-enable');
      
      switch(preset) {
        case 'ninja': // ğŸ¥· ì™„ì „ íˆ¬ëª…
          if (panelSlider) panelSlider.value = 0;
          if (buttonSlider) buttonSlider.value = 15;
          if (blurSlider) blurSlider.value = 0;
          if (hoverCheckbox) hoverCheckbox.checked = true;
          applyStealthMode(0.0, 0, 0, true);
          break;
          
        case 'ghost': // ğŸ‘» ê³ ìŠ¤íŠ¸ ëª¨ë“œ
          if (panelSlider) panelSlider.value = 10;
          if (buttonSlider) buttonSlider.value = 30;
          if (blurSlider) blurSlider.value = 5;
          if (hoverCheckbox) hoverCheckbox.checked = true;
          applyStealthMode(0.1, 0.3, 5, true);
          break;
          
        case 'hover': // âœ¨ í˜¸ë²„ ì „ìš©
          if (panelSlider) panelSlider.value = 5;
          if (buttonSlider) buttonSlider.value = 20;
          if (blurSlider) blurSlider.value = 3;
          if (hoverCheckbox) hoverCheckbox.checked = true;
          applyStealthMode(0.05, 0.2, 3, true);
          break;
          
        case 'reset': // ğŸ”„ ì›ë˜ëŒ€ë¡œ
          if (panelSlider) panelSlider.value = 30;
          if (buttonSlider) buttonSlider.value = 100;
          if (blurSlider) blurSlider.value = 20;
          if (hoverCheckbox) hoverCheckbox.checked = false;
          resetStealthMode();
          break;
      }
      
      // ìŠ¬ë¼ì´ë” ê°’ í‘œì‹œ ì—…ë°ì´íŠ¸
      updateStealthSliderDisplays();
    }
    
    // ìŠ¤í…”ìŠ¤ ëª¨ë“œ í•´ì œ í•¨ìˆ˜
    function resetStealthMode() {
      const panel = document.getElementById('controlPanel');
      if (!panel) return;
      
      const allButtons = panel.querySelectorAll('.effect-button, .control-btn, .play-btn, button');
      
      // ì›ë˜ ìŠ¤íƒ€ì¼ë¡œ ë³µì›
      panel.style.background = 'rgba(243, 208, 147, 0.3)';
      panel.style.border = '1px solid rgba(255, 255, 255, 0.3)';
      panel.style.backdropFilter = 'blur(20px)';
      panel.style.boxShadow = '0 12px 40px rgba(0, 0, 0, 0.3)';
      
      // ë²„íŠ¼ë“¤ ì›ë˜ëŒ€ë¡œ
      allButtons.forEach(btn => {
        btn.style.opacity = '';
        btn.style.color = '';
        btn.style.background = '';
        btn.style.border = '';
        btn.style.filter = '';
      });
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
      panel.onmouseenter = null;
      panel.onmouseleave = null;
      
      stealthSettings.isActive = false;
      addLog('info', 'ğŸ”„ ìŠ¤í…”ìŠ¤ ëª¨ë“œ í•´ì œ');
    }
    
    // ìŠ¤í…”ìŠ¤ ìŠ¬ë¼ì´ë” í‘œì‹œê°’ ì—…ë°ì´íŠ¸
    function updateStealthSliderDisplays() {
      const panelSlider = document.getElementById('stealth-panel-slider');
      const buttonSlider = document.getElementById('stealth-button-slider');
      const blurSlider = document.getElementById('stealth-blur-slider');
      const panelValue = document.getElementById('stealth-panel-value');
      const buttonValue = document.getElementById('stealth-button-value');
      const blurValue = document.getElementById('stealth-blur-value');
      
      if (panelSlider && panelValue) {
        panelValue.textContent = panelSlider.value + '%';
      }
      if (buttonSlider && buttonValue) {
        buttonValue.textContent = buttonSlider.value + '%';
      }
      if (blurSlider && blurValue) {
        blurValue.textContent = blurSlider.value + 'px';
      }
    }
    
    // ===== ì»¨íŠ¸ë¡¤ ì„¼í„° í† ê¸€ ë° í•µì‹¬ í•¨ìˆ˜ë“¤ =====
    
    // ì»¨íŠ¸ë¡¤ ì„¼í„° ëª¨ë“œ í† ê¸€
    function toggleControlCenter() {
      
      
      const controlCenter = document.getElementById('controlCenter');
      const logo1 = document.getElementById('logo1');
      const logo2 = document.getElementById('logo2');

      if (!controlCenter) { console.error('âŒ controlCenter ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤'); return; }
      
      isControlCenterMode = !isControlCenterMode;
      
      if (isControlCenterMode) {
        if (logo1) logo1.classList.add('test-mode');
        if (logo2) logo2.classList.add('test-mode');
        controlCenter.classList.add('show');
        addLog('info', 'ğŸ›ï¸ ì»¨íŠ¸ë¡¤ ì„¼í„° í™œì„±í™”');
        
        // ë“œë˜ê·¸ì•¤ë“œë¡­ ì„¤ì •
        setupDragAndDrop();
        
        // EQ ì»¨íŠ¸ë¡¤ ì„¤ì •
        setTimeout(() => {
          if (typeof setupControlCenterEQControls === 'function') {
            setupControlCenterEQControls();
          }
          
          // ìŠ¤í…”ìŠ¤ ëª¨ë“œ ì»¨íŠ¸ë¡¤ ì„¤ì •
          setupStealthControls();
          
          // ëª¨ë“  ì»¨íŠ¸ë¡¤ ì„¼í„° ì •ë³´ ì—…ë°ì´íŠ¸
          updateControlCenterInfo();
          
          // ê°•ì œë¡œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ UI ì—…ë°ì´íŠ¸
          setTimeout(() => {
            updatePlaylistSelector();
            updateControlCenterPlaylist();
          }, 100);
        }, 50);
        
        // ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ ì‹œì‘ (1ì´ˆë§ˆë‹¤)
        if (!window.controlCenterInterval) {
          window.controlCenterInterval = setInterval(() => {
            if (isControlCenterMode) {
              updateControlCenterVolumeStatus();
              updateControlCenterPlaylist();
            }
          }, 1000);
        }
      } else {
        if (logo1) logo1.classList.remove('test-mode');
        if (logo2) logo2.classList.remove('test-mode');
        controlCenter.classList.remove('show');
        addLog('info', 'ğŸ“º ë°©ì†¡ ëª¨ë“œ í™œì„±í™”');
        
        // ì£¼ê¸°ì  ì—…ë°ì´íŠ¸ ì¤‘ì§€
        if (window.controlCenterInterval) {
          clearInterval(window.controlCenterInterval);
          window.controlCenterInterval = null;
        }
      }
    }

    // ì „ì—­ìœ¼ë¡œ í•¨ìˆ˜ ë…¸ì¶œ (ì¦‰ì‹œ)
    if (typeof window !== 'undefined') {
      window.toggleControlCenter = toggleControlCenter;
      console.log('âœ… toggleControlCenter ì „ì—­ ë“±ë¡ ì™„ë£Œ');
    }
    
    function setupStealthControls() {
      const panelSlider = document.getElementById('stealth-panel-slider');
      const buttonSlider = document.getElementById('stealth-button-slider');
      const blurSlider = document.getElementById('stealth-blur-slider');
      const hoverCheckbox = document.getElementById('stealth-hover-enable');
      
      if (panelSlider) {
        panelSlider.addEventListener('input', (e) => {
          const panelOpacity = parseInt(e.target.value) / 100;
          const buttonOpacity = buttonSlider ? parseInt(buttonSlider.value) / 100 : 1;
          const blurAmount = blurSlider ? parseInt(blurSlider.value) : 20;
          const hoverEnabled = hoverCheckbox ? hoverCheckbox.checked : true;
          
          applyStealthMode(panelOpacity, buttonOpacity, blurAmount, hoverEnabled);
          updateStealthSliderDisplays();
        });
      }
      
      if (buttonSlider) {
        buttonSlider.addEventListener('input', (e) => {
          const buttonOpacity = parseInt(e.target.value) / 100;
          const panelOpacity = panelSlider ? parseInt(panelSlider.value) / 100 : 0.3;
          const blurAmount = blurSlider ? parseInt(blurSlider.value) : 20;
          const hoverEnabled = hoverCheckbox ? hoverCheckbox.checked : true;
          
          applyStealthMode(panelOpacity, buttonOpacity, blurAmount, hoverEnabled);
          updateStealthSliderDisplays();
        });
      }
      
      if (blurSlider) {
        blurSlider.addEventListener('input', (e) => {
          const blurAmount = parseInt(e.target.value);
          const panelOpacity = panelSlider ? parseInt(panelSlider.value) / 100 : 0.3;
          const buttonOpacity = buttonSlider ? parseInt(buttonSlider.value) / 100 : 1;
          const hoverEnabled = hoverCheckbox ? hoverCheckbox.checked : true;
          
          applyStealthMode(panelOpacity, buttonOpacity, blurAmount, hoverEnabled);
          updateStealthSliderDisplays();
        });
      }
      
      if (hoverCheckbox) {
        hoverCheckbox.addEventListener('change', (e) => {
          const hoverEnabled = e.target.checked;
          const panelOpacity = panelSlider ? parseInt(panelSlider.value) / 100 : 0.3;
          const buttonOpacity = buttonSlider ? parseInt(buttonSlider.value) / 100 : 1;
          const blurAmount = blurSlider ? parseInt(blurSlider.value) : 20;
          
          applyStealthMode(panelOpacity, buttonOpacity, blurAmount, hoverEnabled);
        });
      }
      
      // ì´ˆê¸° í‘œì‹œê°’ ì„¤ì •
      updateStealthSliderDisplays();
    }

    // ===== ë°°ê²½ ë° ë¯¸ë””ì–´ ê´€ë¦¬ í•¨ìˆ˜ë“¤ =====

    // ë£¨í”„ ì˜ìƒ êµì²´ í•¨ìˆ˜ - ì•ˆì •ì„± ê°œì„ 
    function changeLoopVideos(loop1Path, loop2Path) {
  console.log('ğŸ”„ changeLoopVideos í˜¸ì¶œë¨');
  console.log('loop1Path:', loop1Path);
  console.log('loop2Path:', loop2Path);
  
  const loop1Video = document.getElementById('loop1');
  const loop2Video = document.getElementById('loop2');

  addLog('info', `ë£¨í”„ ì˜ìƒ êµì²´ ì‹œì‘: ${loop1Path.split('/').pop()}, ${loop2Path.split('/').pop()}`);

      // í˜„ì¬ ë¹„ë””ì˜¤ ì™„ì „ ì •ì§€ ë° ìˆ¨ê¸°ê¸°
      loop1Video.pause();
      loop2Video.pause();
      loop1Video.currentTime = 0;
      loop2Video.currentTime = 0;

      // ì„œì„œíˆ í˜ì´ë“œ ì•„ì›ƒ
      fadeOut(loop1Video);
      fadeOut(loop2Video);

      // ğŸ”§ ìˆ˜ì •: muted ì†ì„± ì¶”ê°€ (autoplay ì •ì±… ì¤€ìˆ˜)
      loop1Video.muted = true;
      loop2Video.muted = true;

      // ìƒˆ ì†ŒìŠ¤ ì„¤ì •
      const source1 = loop1Video.querySelector('source');
      const source2 = loop2Video.querySelector('source');
      source1.src = loop1Path;
      source2.src = loop2Path;

      // ë¹„ë””ì˜¤ ë‹¤ì‹œ ë¡œë“œ
      loop1Video.load();
      loop2Video.load();
      
      // í˜„ì¬ ë£¨í”„ ì˜ìƒ ì •ë³´ ì—…ë°ì´íŠ¸
      currentLoopVideos.loop1 = loop1Path;
      currentLoopVideos.loop2 = loop2Path;
      
      // ë¡œë“œ ì™„ë£Œ í›„ ì¬ìƒ ì‹œì‘
      let loadedCount = 0;
      const totalVideos = 2;
      
      const onVideoLoaded = () => {
        loadedCount++;
        addLog('info', `ë¹„ë””ì˜¤ ë¡œë“œ ì™„ë£Œ: ${loadedCount}/${totalVideos}`);
        
        if (loadedCount >= totalVideos) {
          // ëª¨ë“  ë¹„ë””ì˜¤ ë¡œë“œ ì™„ë£Œ - ì¬ìƒ ì‹œì‘
          setTimeout(() => {
            addLog('info', 'ìƒˆ ë£¨í”„ ì˜ìƒ ì¬ìƒ ì‹œì‘');
            
            // ì²« ë²ˆì§¸ ë¹„ë””ì˜¤ë¶€í„° ì‹œì‘
            loop1Video.currentTime = 0;
            loop2Video.currentTime = 0;
            
            // ì²« ë²ˆì§¸ ë¹„ë””ì˜¤ ì¬ìƒ ì‹œì‘
            fadeIn(loop1Video);
            loop1Video.play().then(() => {
              addLog('info', 'ë£¨í”„ ì˜ìƒ ì¬ìƒ ì„±ê³µ');
              
              // ì²« ë²ˆì§¸ ë¹„ë””ì˜¤ ì¢…ë£Œ ì‹œ ë‘ ë²ˆì§¸ë¡œ ì „í™˜í•˜ëŠ” ì´ë²¤íŠ¸ ì„¤ì •
              loop1Video.onended = () => {
                fadeOut(loop1Video);
                setTimeout(() => {
                  playLoop(loop2Video, loop1Video);
                }, 100);
              };
            }).catch((error) => {
              addLog('error', `ë£¨í”„ ì˜ìƒ ì¬ìƒ ì‹¤íŒ¨: ${error.message}`);
              // ì¬ìƒ ì‹¤íŒ¨ ì‹œ ë‹¤ì‹œ ì‹œë„
              setTimeout(() => {
                fadeIn(loop1Video);
                loop1Video.play().catch(e => console.error('ì¬ì‹œë„ ì‹¤íŒ¨:', e));
              }, 1000);
            });
          }, 500); // 0.5ì´ˆ ëŒ€ê¸°
        }
      };
      
      const onVideoError = (video, videoName) => {
        addLog('error', `${videoName} ë¡œë“œ ì‹¤íŒ¨`);
        loadedCount++; // ì—ëŸ¬ì—¬ë„ ì¹´ìš´íŠ¸ ì¦ê°€
        if (loadedCount >= totalVideos) {
          addLog('warning', 'ì¼ë¶€ ë¹„ë””ì˜¤ ë¡œë“œ ì‹¤íŒ¨, ê¸°ì¡´ ì˜ìƒ ìœ ì§€');
        }
      };
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡ (í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ë„ë¡)
      loop1Video.addEventListener('loadeddata', onVideoLoaded, { once: true });
      loop2Video.addEventListener('loadeddata', onVideoLoaded, { once: true });
      loop1Video.addEventListener('error', () => onVideoError(loop1Video, 'Loop1'), { once: true });
      loop2Video.addEventListener('error', () => onVideoError(loop2Video, 'Loop2'), { once: true });
      
      // íƒ€ì„ì•„ì›ƒ ì•ˆì „ì¥ì¹˜ (10ì´ˆ)
      setTimeout(() => {
        if (loadedCount < totalVideos) {
          addLog('warning', 'ë¹„ë””ì˜¤ ë¡œë“œ íƒ€ì„ì•„ì›ƒ, ê°•ì œ ì‹œì‘');
          onVideoLoaded(); // ê°•ì œë¡œ ë¡œë“œ ì™„ë£Œ ì²˜ë¦¬
        }
      }, 10000);
    }

    // ë°°ê²½ ì´ë¯¸ì§€ ë³€ê²½ í•¨ìˆ˜ - ëœë¤ ì´ë¯¸ì§€ ê²€ìƒ‰ ê°œì„ 
    async function changeBackgroundImage(imageUrl) {
      // ë£¨í”„ ì˜ìƒ ì •ì§€
      const loop1Video = document.getElementById('loop1');
      const loop2Video = document.getElementById('loop2');
      loop1Video.pause();
      loop2Video.pause();
      fadeOut(loop1Video);
      fadeOut(loop2Video);
      
      if (imageUrl) {
        
        // ì´ë¯¸ì§€ ë¡œë”© í™•ì¸ì„ ìœ„í•œ í”„ë¦¬ë¡œë“œ
        const img = new Image();
        img.onload = () => {
          document.body.style.backgroundImage = `url(${imageUrl})`;
          document.body.style.backgroundSize = 'cover';
          document.body.style.backgroundPosition = 'center';
          document.body.style.backgroundRepeat = 'no-repeat';
        };
        img.onerror = () => {
          console.error('âŒ ë°°ê²½ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨');
          // ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ë°°ê²½
          document.body.style.backgroundImage = '';
          document.body.style.backgroundColor = '#000';
        };
        img.src = imageUrl;
      } else {
        document.body.style.backgroundImage = '';
        document.body.style.backgroundColor = '#000';
      }
      
      addLog('info', `ë°°ê²½ ì´ë¯¸ì§€ ì ìš©: ${imageUrl || 'ê¸°ë³¸ ê²€ì€ ë°°ê²½'}`);
    }

    // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ íŒŒì¼ ë¡œë“œ í•¨ìˆ˜ - ì™„ì „íˆ ê°œì„ ëœ ë²„ì „
    function loadPlaylistFiles() {
      const input = document.createElement('input');
      input.type = 'file';
      input.multiple = true;
      input.accept = '.js,.json';
      
      addLog('info', 'í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ íŒŒì¼ ì„ íƒ ëŒ€í™”ìƒì ì—´ê¸°...');
      
      input.addEventListener('change', (e) => {
        const files = Array.from(e.target.files);
        
        if (files.length === 0) {
          addLog('warning', 'íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
          return;
        }
        
        addLog('info', `${files.length}ê°œ íŒŒì¼ ë¡œë“œ ì‹œì‘`);
        
        let loadedCount = 0;
        let totalFiles = files.length;
        let successCount = 0;
        
        files.forEach((file, index) => {
          addLog('info', `íŒŒì¼ ì²˜ë¦¬ ì¤‘: ${file.name}`);
          
          const reader = new FileReader();
          
          reader.onload = (event) => {
            try {
              const content = event.target.result;
              
              let playlist;
              let extractedTracks = null;
              
              if (file.name.endsWith('.json')) {
                // JSON íŒŒì¼ ì²˜ë¦¬
                addLog('info', `JSON íŒŒì¼ íŒŒì‹±: ${file.name}`);
                const jsonData = JSON.parse(content);
                
                playlist = {
                  name: jsonData.name || file.name.replace('.json', ''),
                  tracks: Array.isArray(jsonData.tracks) ? jsonData.tracks : (Array.isArray(jsonData) ? jsonData : [])
                };
                
              } else if (file.name.endsWith('.js')) {
                // JavaScript íŒŒì¼ ì²˜ë¦¬ - ë‹¤ì¤‘ ë°©ì‹ ì‹œë„
                addLog('info', `JavaScript íŒŒì¼ íŒŒì‹±: ${file.name}`);
                
                try {
                  // Function ìƒì„±ìë¥¼ ì‚¬ìš©í•œ ì•ˆì „í•œ ì‹¤í–‰
                  const safeContent = content + '\n\n' +
                    'if (typeof lofiTracks !== "undefined" && Array.isArray(lofiTracks)) return lofiTracks;\n' +
                    'if (typeof pop2Playlist !== "undefined" && Array.isArray(pop2Playlist)) return pop2Playlist;\n' +
                    'if (typeof musicTracks !== "undefined" && Array.isArray(musicTracks)) return musicTracks;\n' +
                    'if (typeof playlist !== "undefined" && Array.isArray(playlist)) return playlist;\n' +
                    'if (typeof tracks !== "undefined" && Array.isArray(tracks)) return tracks;\n' +
                    'return null;';
                  
                  const func = new Function(safeContent);
                  const result = func();
                  
                  if (result && Array.isArray(result)) {
                    extractedTracks = result;
                  }
                  
                } catch (funcError) {
                }
                
                if (extractedTracks && Array.isArray(extractedTracks)) {
                  playlist = {
                    name: file.name.replace('.js', ''),
                    tracks: extractedTracks
                  };
                } else {
                  throw new Error('JavaScript íŒŒì¼ì—ì„œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë°°ì—´ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }
              }
              
              // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê²€ì¦ ë° ì¶”ê°€
              if (playlist && playlist.tracks && Array.isArray(playlist.tracks) && playlist.tracks.length > 0) {
                const validTracks = playlist.tracks.filter(track => {
                  return track && 
                         typeof track === 'object' && 
                         track.title && 
                         typeof track.title === 'string' &&
                         track.src && 
                         typeof track.src === 'string';
                });
                
                if (validTracks.length > 0) {
                  const newPlaylist = {
                    id: `loaded_${Date.now()}_${index}`,
                    name: playlist.name,
                    tracks: validTracks
                  };
                  
                  loadedPlaylists.push(newPlaylist);
                  successCount++;
                  
                  addLog('info', `âœ… í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¡œë“œ: ${playlist.name} (${validTracks.length}ê³¡)`);
                } else {
                  addLog('warning', `ìœ íš¨í•œ íŠ¸ë™ì´ ì—†ìŒ: ${file.name}`);
                }
              } else {
                addLog('warning', `ë¹ˆ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸: ${file.name}`);
              }
              
            } catch (error) {
              console.error('ğŸ“„ íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
              addLog('error', `í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¡œë“œ ì‹¤íŒ¨ (${file.name}): ${error.message}`);
            }
            
            loadedCount++;
            
            if (loadedCount === totalFiles) {
              updatePlaylistSelector();
              addLog('info', `ğŸ“‹ ë¡œë“œ ì™„ë£Œ: ${successCount}ê°œ ì„±ê³µ, ${totalFiles - successCount}ê°œ ì‹¤íŒ¨`);
            }
          };
          
          reader.onerror = (error) => {
            console.error('ğŸ“„ íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
            addLog('error', `íŒŒì¼ ì½ê¸° ì‹¤íŒ¨: ${file.name}`);
            loadedCount++;
            
            if (loadedCount === totalFiles) {
              updatePlaylistSelector();
              addLog('info', `ë¡œë“œ ì™„ë£Œ: ${successCount}ê°œ ì„±ê³µ`);
            }
          };
          
          // UTF-8 ì¸ì½”ë”©ìœ¼ë¡œ íŒŒì¼ ì½ê¸°
          reader.readAsText(file, 'UTF-8');
        });
      });
      
      input.click();
    }

    // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜
    function resetPlaylists() {
      
      broadcastPlaylist = [];
      musicTracks = [];
      shuffledPlaylist = [];
      currentTrackIndex = 0;
      
      // ëª¨ë“  ì²´í¬ë°•ìŠ¤ í•´ì œ
      const checkboxes = document.querySelectorAll('#playlistSelector input[type="checkbox"]:not(#playlistShuffle)');
      checkboxes.forEach(cb => {
        cb.checked = false;
      });
      
      // ìŒì•… ì •ì§€
      if (isMusicPlaying) {
        toggleMusic();
      }
      
      updatePlaylistSelector();
      updateControlCenterPlaylist();
      addLog('info', 'ë°©ì†¡ìš© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');
    }

    // ë°°ê²½ ì„ íƒê¸° ì—…ë°ì´íŠ¸ - ëœë¤ ì´ë¯¸ì§€ ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€
    function updateBackgroundSelector() {
      if (!isControlCenterMode) return;
      
      const backgroundSelector = document.getElementById('backgroundSelector');
      if (!backgroundSelector) return;
      
      backgroundSelector.innerHTML = `
        <h4>ğŸ² ìë™ ë°°ê²½ ì´ë¯¸ì§€ ê²€ìƒ‰</h4>
        <div style="font-size: 10px; color: #90A4AE; margin-bottom: 8px;">ğŸ² ëª¨ë“  "ìƒˆë¡œìš´ ì´ë¯¸ì§€" ë²„íŠ¼ì€ í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ëœë¤ ì´ë¯¸ì§€ë¥¼ ìë™ ê²€ìƒ‰í•©ë‹ˆë‹¤!</div>
      `;
      
      // ê¸°ë³¸ ì´ë¯¸ì§€ë“¤ ì¶”ê°€
      defaultBackgroundImages.forEach((bg, index) => {
        const bgItem = document.createElement('div');
        bgItem.className = 'background-item';
        
        const categoryIcons = {
          'ì‚°': 'ğŸ”ï¸',
          'ë°”ë‹¤': 'ğŸŒŠ', 
          'ìˆ²': 'ğŸŒ²',
          'ë„ì‹œ': 'ğŸ™ï¸',
          'ì¸ë¬¼': 'ğŸ‘©'
        };
        
        const icon = categoryIcons[bg.name] || 'ğŸ–¼ï¸';
        
        bgItem.innerHTML = `
          <input type="radio" id="bg-default-${index}" name="background" value="default-${index}">
          <label for="bg-default-${index}">${icon} ${bg.name} (ìë™ ê²€ìƒ‰)</label>
          <button class="apply-bg-btn" data-type="default" data-index="${index}" style="margin-left: 10px; padding: 2px 8px; background: #4CAF50; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 10px;">ğŸ² ìƒˆë¡œìš´ ì´ë¯¸ì§€</button>
        `;
        backgroundSelector.appendChild(bgItem);
        
        const button = bgItem.querySelector('.apply-bg-btn');
        button.addEventListener('click', async () => {
          await applyBackgroundMedia('default', index);
        });
      });
      
      // ë¡œë“œëœ ë¯¸ë””ì–´ë“¤ ì¶”ê°€
      loadedBackgroundMedia.forEach((media, index) => {
        if (media.name === 'ê¸°ë³¸ ë£¨í”„ ì˜ìƒ') return;
        
        const bgItem = document.createElement('div');
        bgItem.className = 'background-item';
        const icon = media.type === 'video' ? 'ğŸ¬' : 'ğŸ“·';
        bgItem.innerHTML = `
          <input type="radio" id="bg-loaded-${index}" name="background" value="loaded-${index}">
          <label for="bg-loaded-${index}">${icon} ${media.name} (ë¡œì»¬ íŒŒì¼)</label>
          <button class="apply-local-btn" data-type="loaded" data-index="${index}" style="margin-left: 10px; padding: 2px 8px; background: #FF9800; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 10px;">ì ìš©</button>
        `;
        backgroundSelector.appendChild(bgItem);
        
        const button = bgItem.querySelector('.apply-local-btn');
        button.addEventListener('click', async () => {
          console.log('ğŸ”˜ ë°°ê²½ ì ìš© ë²„íŠ¼ í´ë¦­ë¨, ì¸ë±ìŠ¤:', index);
          await applyBackgroundMedia('loaded', index);
        });
      });
    }

    // ë°°ê²½ ë¯¸ë””ì–´ ì ìš© í•¨ìˆ˜
    function applyBackgroundMedia(type, index) {
  if (type === 'default') {
        const media = defaultBackgroundImages[index];
        if (media.type === 'image') {
          changeBackgroundImage(media.url);
        }
      } else if (type === 'loaded') {
        const media = loadedBackgroundMedia[index];
        if (media.type === 'image') {
          changeBackgroundImage(media.url);
        } else if (media.type === 'video') {
          changeLoopVideos(media.loop1, media.loop2);
        }
      }
    }

    // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì„ íƒê¸° ì—…ë°ì´íŠ¸
    function updatePlaylistSelector() {
      if (!isControlCenterMode) return;
      
      const playlistSelector = document.getElementById('playlistSelector');
      if (!playlistSelector) return;
      
      playlistSelector.innerHTML = `
        <h4>ğŸµ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬</h4>
        <div style="margin-bottom: 10px;">
          <button onclick="loadPlaylistFiles()" style="padding: 5px 10px; background: #4FC3F7; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 5px;">ğŸ“ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸°</button>
          <button onclick="applySelectedPlaylists()" style="padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 5px;">âœ… ì ìš©</button>
          <button onclick="resetPlaylists()" style="padding: 5px 10px; background: #FF5722; color: white; border: none; border-radius: 5px; cursor: pointer;">ğŸ”„ ì´ˆê¸°í™”</button>
        </div>
        <div style="font-size: 11px; color: #90A4AE; margin-bottom: 10px;">
          ë°©ì†¡ìš© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸: ${broadcastPlaylist.length}ê³¡
        </div>
      `;
      
      const validPlaylists = loadedPlaylists.filter(playlist => {
        return playlist.tracks && playlist.tracks.length > 0;
      });
      
      if (validPlaylists.length > 0) {
        validPlaylists.forEach((playlist, index) => {
          const playlistItem = document.createElement('div');
          playlistItem.className = 'playlist-item-selector';
          playlistItem.innerHTML = `
            <input type="checkbox" id="playlist-${playlist.id}" value="${playlist.id}">
            <label for="playlist-${playlist.id}">${playlist.name} (${playlist.tracks.length}ê³¡)</label>
          `;
          
          playlistSelector.appendChild(playlistItem);
          
          const checkbox = playlistItem.querySelector('input[type="checkbox"]');
          checkbox.addEventListener('change', (e) => {
          });
        });
      } else {
        const noPlaylistMsg = document.createElement('div');
        noPlaylistMsg.style.cssText = 'font-size: 11px; color: #90A4AE; text-align: center; padding: 10px;';
        noPlaylistMsg.textContent = 'í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”';
        playlistSelector.appendChild(noPlaylistMsg);
      }
      
      // ì…”í”Œ ì˜µì…˜
      const shuffleOption = document.createElement('div');
      shuffleOption.className = 'shuffle-option';
      shuffleOption.innerHTML = `
        <input type="checkbox" id="playlistShuffle" ${isShuffleMode ? 'checked' : ''}>
        <label for="playlistShuffle">ğŸ”€ ì…”í”Œ ì¬ìƒ</label>
      `;
      
      const shuffleCheckbox = shuffleOption.querySelector('input');
      shuffleCheckbox.addEventListener('change', (e) => {
        isShuffleMode = e.target.checked;
        toggleShuffle();
        addLog('info', `ì…”í”Œ ëª¨ë“œ: ${isShuffleMode ? 'ON' : 'OFF'}`);
      });
      
      playlistSelector.appendChild(shuffleOption);
    }

    // ì„ íƒëœ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë“¤ì„ ë°©ì†¡ìš© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¡œ ì ìš©
    function applySelectedPlaylists() {
      const checkboxes = document.querySelectorAll('#playlistSelector input[type="checkbox"]:not(#playlistShuffle)');
      
      const selectedIds = [];
      checkboxes.forEach((cb) => {
        if (cb.checked) {
          selectedIds.push(cb.value);
        }
      });
      
      if (selectedIds.length === 0) {
        addLog('warning', 'ì„ íƒëœ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      broadcastPlaylist = [];
      let totalTracks = 0;
      
      selectedIds.forEach(playlistId => {
        const playlist = loadedPlaylists.find(p => p.id === playlistId);
        
        if (playlist && playlist.tracks.length > 0) {
          const tracksWithInfo = playlist.tracks.map(track => ({
            title: track.title,
            src: track.src,
            playlist: playlist.name
          }));
          
          broadcastPlaylist = broadcastPlaylist.concat(tracksWithInfo);
          totalTracks += playlist.tracks.length;
          addLog('info', `í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì¶”ê°€: ${playlist.name} (${playlist.tracks.length}ê³¡)`);
        }
      });
      
      musicTracks = [...broadcastPlaylist];
      
      if (isShuffleMode && musicTracks.length > 0) {
        shuffledPlaylist = createShuffledPlaylist();
        addLog('info', 'ì…”í”Œ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ìƒì„± ì™„ë£Œ');
      }
      
      // ì¦‰ì‹œ ì ìš©
      const wasPlaying = isMusicPlaying;
      if (musicTracks.length > 0) {
        currentTrackIndex = 0;
        loadTrack(0);
        
        if (wasPlaying) {
          setTimeout(async () => {
            if (musicPlayer && !musicPlayer.paused) {
              await fadeOutAudio(musicPlayer, 500);
              musicPlayer.pause();
            }
            
            setTimeout(() => {
              playMusicSafely();
            }, 100);
          }, 100);
        }
        
        addLog('info', `âœ… í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì¦‰ì‹œ ì ìš©: ${musicTracks[0]?.title || 'ì²« ê³¡'}`);
      }
      
      addLog('info', `âœ… ë°©ì†¡ìš© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì ìš© ì™„ë£Œ: ì´ ${broadcastPlaylist.length}ê³¡`);
      
      if (isControlCenterMode) {
        updateControlCenterPlaylist();
        updatePlaylistSelector();
      }
    }

    // ===== ìŒì•… í”Œë ˆì´ì–´ í•µì‹¬ í•¨ìˆ˜ë“¤ =====

    // DOM ìš”ì†Œë“¤
    const startButton = document.getElementById("startButton");
    const loop1 = document.getElementById("loop1");
    const loop2 = document.getElementById("loop2");
    const overlayVideo = document.getElementById("overlayVideo");
    const logo1 = document.getElementById("logo1");
    const logo2 = document.getElementById("logo2");
    const controlPanel = document.getElementById("controlPanel");
    const titleDisplay = document.getElementById("titleDisplay");
    const musicPlayer = document.getElementById("musicPlayer");
    const playBtn = document.getElementById("playBtn");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const audioVisualizer = document.getElementById("audioVisualizer");

    // ìƒíƒœ ë³€ìˆ˜ë“¤
    let currentLoop = 1;
    let isBroadcasting = false;
    let currentEffect = null;
    let isMusicPlaying = false;
    let currentTrackIndex = 0;
    let isShuffleMode = true;
    let shuffledPlaylist = [];
    let logoLoopStarted = false;

    // í”Œë ˆì´ë¦¬ìŠ¤íŠ¸
    let musicTracks = [];

    // ì˜¤ë””ì˜¤ ë¶„ì„ìš© ë³€ìˆ˜ë“¤
    let audioContext;
    let analyser;
    let dataArray;
    let source;
    let animationId;
    let eqLow, eqMid, eqHigh;
    let gainNode;
    let compressor;

    // ê°„ë‹¨í•œ ë³¼ë¥¨ ê´€ë¦¬
    const audioManager = {
      baseVolume: 0.5,
      
      setBaseVolume(volume) {
        this.baseVolume = Math.max(0.1, Math.min(0.8, volume));
        if (musicPlayer) {
          musicPlayer.volume = Math.max(0, Math.min(1, this.baseVolume));
        }
      },

      onNewTrack() {
        if (musicPlayer) {
          musicPlayer.volume = Math.max(0, Math.min(1, this.baseVolume));
        }
      }
    };

    // ì™¸ë¶€ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¡œë“œ
    function loadExternalPlaylists() {
      try {
        if (typeof pop2Playlist !== 'undefined' && Array.isArray(pop2Playlist)) {
          musicTracks = [...pop2Playlist];
          
          loadedPlaylists[0] = {
            id: 'default',
            name: 'ê¸°ë³¸ K-Pop í”Œë ˆì´ë¦¬ìŠ¤íŠ¸',
            tracks: [...pop2Playlist]
          };
          
          broadcastPlaylist = [...pop2Playlist];
          shuffledPlaylist = createShuffledPlaylist();
          
      setTimeout(() => {
        if (isControlCenterMode) {
          updatePlaylistSelector();
          updateControlCenterPlaylist();
          addLog('info', `ê¸°ë³¸ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¡œë“œ: ${pop2Playlist.length}ê³¡`);
          
          // ğŸ†• ìë™ìœ¼ë¡œ ì ìš©
          setTimeout(() => {
            applySelectedPlaylists();
          }, 100);
        }
      }, 50);
          
        } else {
          console.warn('âŒ a-pop-1-playlist.js í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          musicTracks = [];
          broadcastPlaylist = [];
          shuffledPlaylist = [];
        }
      } catch (error) {
        console.error('ì™¸ë¶€ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
        musicTracks = [];
        broadcastPlaylist = [];
        shuffledPlaylist = [];
      }
    }

    // Web Audio API ì´ˆê¸°í™”
    function initAudioContext() {
      try {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        analyser.fftSize = 1024;
        analyser.smoothingTimeConstant = 0.3;

        eqLow = audioContext.createBiquadFilter();
        eqMid = audioContext.createBiquadFilter();
        eqHigh = audioContext.createBiquadFilter();
        gainNode = audioContext.createGain();
        compressor = audioContext.createDynamicsCompressor();

        compressor.threshold.value = -18;
        compressor.knee.value = 8;
        compressor.ratio.value = 3;
        compressor.attack.value = 0.001;
        compressor.release.value = 0.2;

        eqLow.type = 'lowshelf';
        eqLow.frequency.value = 120;
        eqLow.gain.value = 4;
        
        eqMid.type = 'peaking';
        eqMid.frequency.value = 700;
        eqMid.Q.value = 1;
        eqMid.gain.value = 2.5;
        
        eqHigh.type = 'highshelf';
        eqHigh.frequency.value = 4500;
        eqHigh.gain.value = -2;
        
        gainNode.gain.value = 0.9;
        
        const bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
        
      } catch (error) {
        console.error('Audio Context ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
      }
    }

    // ë¹„ì£¼ì–¼ë¼ì´ì € í•¨ìˆ˜ë“¤
    function startRealVisualizer() {
      try {
        if (!audioContext) initAudioContext();
        if (audioContext.state === 'suspended') audioContext.resume();

        if (!source && musicPlayer.src && !musicPlayer._audioSourceConnected) {
          source = audioContext.createMediaElementSource(musicPlayer);
          musicPlayer._audioSourceConnected = true;
          
          source.connect(eqLow);
          eqLow.connect(eqMid);
          eqMid.connect(eqHigh);
          eqHigh.connect(compressor);
          compressor.connect(gainNode);
          gainNode.connect(analyser);
          analyser.connect(audioContext.destination);
        }

        const bufferLength = analyser.frequencyBinCount;
        dataArray = new Uint8Array(bufferLength);
        audioVisualizer.classList.add('playing');
        updateRealVisualizer();
        
      } catch (error) {
        console.error('ì‹¤ì œ ë¶„ì„ ì‹¤íŒ¨, ê¸°ë³¸ ì• ë‹ˆë©”ì´ì…˜ ì‚¬ìš©:', error);
        startFallbackVisualizer();
      }
    }

    function startFallbackVisualizer() {
      audioVisualizer.classList.add('playing');
      const bars = document.querySelectorAll('.visualizer-bar');
      
      function animateBars() {
        bars.forEach((bar) => {
          const height = 3 + Math.random() * 25;
          bar.style.height = height + 'px';
          bar.style.opacity = '1.0';
        });
        
        if (isMusicPlaying) {
          setTimeout(animateBars, 100);
        }
      }
      
      animateBars();
    }

    function updateRealVisualizer() {
      if (!analyser || !dataArray || !isMusicPlaying) return;
      
      analyser.getByteFrequencyData(dataArray);
      const bars = document.querySelectorAll('.visualizer-bar');
      
      let totalActivity = 0;
      for (let i = 0; i < dataArray.length; i++) {
        totalActivity += dataArray[i];
      }
      const avgActivity = totalActivity / dataArray.length;
      
      bars.forEach((bar, index) => {
        let value = 0;
        
        if (avgActivity > 2) {
          const startFreq = Math.floor(dataArray.length * 0.10);
          const endFreq = Math.floor(dataArray.length * 0.72);
          const usableRange = endFreq - startFreq;
          
          const overlap = 1.3;
          const barWidth = (usableRange / bars.length) * overlap;
          const myStartFreq = startFreq + Math.floor(index * (usableRange / bars.length));
          const myEndFreq = Math.min(myStartFreq + Math.floor(barWidth), dataArray.length - 1);
          
          let maxVal = 0;
          let sum = 0;
          let count = 0;
          
          for (let i = myStartFreq; i <= myEndFreq && i < dataArray.length; i++) {
            const val = dataArray[i];
            maxVal = Math.max(maxVal, val);
            sum += val;
            count++;
          }
          
          const avgVal = count > 0 ? sum / count : 0;
          value = (maxVal * 0.80) + (avgVal * 0.15);
          value *= 1.1;
          
          if (index >= 30) {
            value *= 1.5;
          } else if (index >= 25) {
            value *= 1.2;
          }
        }
        
        const height = Math.max(2, Math.min(30, (value / 255) * 28 + 2));
        bar.style.height = height + 'px';
        bar.style.opacity = '1.0';
      });
      
      if (isMusicPlaying) {
        animationId = requestAnimationFrame(updateRealVisualizer);
      }
    }

    function stopVisualizer() {
      audioVisualizer.classList.remove('playing');
      if (animationId) {
        cancelAnimationFrame(animationId);
        animationId = null;
      }
      
      const bars = document.querySelectorAll('.visualizer-bar');
      bars.forEach(bar => {
        bar.style.height = '2px';
        bar.style.opacity = '1.0';
      });
    }

    // ë¹„ë””ì˜¤ í˜ì´ë“œ íš¨ê³¼
    function fadeIn(video) {
      video.style.visibility = 'visible';
      video.style.opacity = 1;
    }

    function fadeOut(video) {
      video.style.opacity = 0;
      setTimeout(() => {
        video.style.visibility = 'hidden';
      }, 500);
    }

    // ë£¨í”„ ì¬ìƒ
    function playLoop(loopA, loopB) {
      loopA.currentTime = 0;
      fadeIn(loopA);
      loopA.play().catch(error => console.error("Loop video play failed:", error));

      loopA.onended = () => {
        fadeOut(loopA);
        setTimeout(() => {
          playLoop(loopB, loopA);
        }, 10);
      };
    }

    // íš¨ê³¼ìŒ í† ê¸€
    function toggleEffect(effectName) {
            // ğŸ”Š í´ë¦­ ì†Œë¦¬ ì¶”ê°€
      playClickSound();
      const effectAudio = document.getElementById('effect-' + effectName);
      if (!effectAudio) return;

      if (currentEffect && currentEffect !== effectName) {
        const currentAudio = document.getElementById('effect-' + currentEffect);
        if (currentAudio) {
          currentAudio.pause();
          currentAudio.currentTime = 0;
        }
        
        document.querySelectorAll('.effect-button').forEach(btn => {
          btn.classList.remove('active');
        });
      }

      if (currentEffect === effectName) {
        effectAudio.pause();
        effectAudio.currentTime = 0;
        currentEffect = null;
        document.querySelector(`[onclick="toggleEffect('${effectName}')"]`).classList.remove('active');
        if (isControlCenterMode) {
          addLog('info', `${effectName} íš¨ê³¼ìŒ ì •ì§€`);
          updateControlCenterEffectVolumes();
        }
        return;
      }

      const volume = effectVolumes[effectName] || (effectName === 'rain' ? 0.95 : 0.5);
      effectAudio.volume = Math.max(0, Math.min(1, volume));
      
      effectAudio.play().then(() => {
        currentEffect = effectName;
        document.querySelector(`[onclick="toggleEffect('${effectName}')"]`).classList.add('active');
        if (isControlCenterMode) {
          addLog('info', `${effectName} íš¨ê³¼ìŒ ì¬ìƒ (${Math.round(volume * 100)}%)`);
          updateControlCenterEffectVolumes();
        }
      }).catch(error => {
        console.error('íš¨ê³¼ìŒ ì¬ìƒ ì‹¤íŒ¨:', error);
        if (isControlCenterMode) {
          addLog('error', `${effectName} ì¬ìƒ ì‹¤íŒ¨: ${error.message}`);
        }
      });
    }

    // ìŒì•… í”Œë ˆì´ì–´ ì œì–´
    function toggleMusic() {
      const currentPlaylist = getCurrentPlaylist();
      
      if (!currentPlaylist || currentPlaylist.length === 0) {
        if (musicTracks && musicTracks.length > 0) {
        } else if (broadcastPlaylist && broadcastPlaylist.length > 0) {
          musicTracks = [...broadcastPlaylist];
          if (isShuffleMode) {
            shuffledPlaylist = createShuffledPlaylist();
          }
        } else {
          if (isControlCenterMode) {
            addLog('error', 'í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤. í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”.');
          }
          loadExternalPlaylists();
          if (!musicTracks || musicTracks.length === 0) {
            return;
          }
        }
      }

      if (isMusicPlaying) {
        musicPlayer.pause();
        playBtn.textContent = 'â–¶';
        isMusicPlaying = false;
        stopVisualizer();
        if (isControlCenterMode) {
          addLog('info', 'ğŸµ ìŒì•… ì •ì§€');
        }
      } else {
        playMusicSafely();
      }
    }

    function createShuffledPlaylist() {
      const shuffled = [...musicTracks];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function toggleShuffle() {
      isShuffleMode = !isShuffleMode;
      
      if (isShuffleMode) {
        shuffledPlaylist = createShuffledPlaylist();
        shuffleBtn.classList.add('active');
        if (isControlCenterMode) {
          addLog('info', 'ğŸ”€ ì…”í”Œ ëª¨ë“œ ON');
        }
      } else {
        shuffleBtn.classList.remove('active');
        if (isControlCenterMode) {
          addLog('info', 'ğŸ“‹ ì…”í”Œ ëª¨ë“œ OFF');
        }
      }
      
      currentTrackIndex = 0;
      
      if (isControlCenterMode) {
        const shuffleCheckbox = document.getElementById('playlistShuffle');
        if (shuffleCheckbox) {
          shuffleCheckbox.checked = isShuffleMode;
        }
        updateControlCenterPlaylist();
      }
    }

    function getCurrentPlaylist() {
      return isShuffleMode ? shuffledPlaylist : musicTracks;
    }

    function getCurrentTrackInfo() {
      const playlist = getCurrentPlaylist();
      const track = playlist[currentTrackIndex];
      return track ? {
        title: track.title,
        src: track.src,
        index: currentTrackIndex,
        isShuffleMode: isShuffleMode,
        playlist: track.playlist
      } : null;
    }

    function loadTrack(index) {
      const playlist = getCurrentPlaylist();
      if (index < 0 || index >= playlist.length) return;
      
      const track = playlist[index];
      
      if (musicPlayer.src === track.src && currentTrackIndex === index) {
        return;
      }
      
      const wasPlaying = !musicPlayer.paused;
      if (wasPlaying) {
        musicPlayer.pause();
      }
      
      setTimeout(() => {
        musicPlayer.src = track.src;
        musicPlayer.volume = Math.max(0, Math.min(1, audioManager.baseVolume));
        currentTrackIndex = index;
        
        if (audioManager) {
          audioManager.onNewTrack();
        }
        
        if (isControlCenterMode) {
          addLog('info', `íŠ¸ë™ ë¡œë“œ: ${track.title}`);
          updateControlCenterPlaylist();
        }
      }, 100);
    }

    function nextTrack() {
      const playlist = getCurrentPlaylist();
      let newIndex = currentTrackIndex + 1;
      if (newIndex >= playlist.length) {
        newIndex = 0;
        if (isShuffleMode) {
          shuffledPlaylist = createShuffledPlaylist();
        }
      }
      
      const wasPlaying = isMusicPlaying;
      if (isMusicPlaying && musicPlayer) {
        fadeOutAudio(musicPlayer, 500).then(() => {
          musicPlayer.pause();
          isMusicPlaying = false;
          
          loadTrack(newIndex);
          
          if (wasPlaying) {
            setTimeout(() => {
              playMusicSafely();
            }, 1500);
          }
        });
      } else {
        loadTrack(newIndex);
      }
    }

    async function playMusicSafely() {
      if (isMusicPlaying) return;
      
      try {
        if (!musicPlayer.src) {
          loadTrack(currentTrackIndex);
          await new Promise(resolve => {
            const checkLoaded = () => {
              if (musicPlayer.readyState >= 3) {
                resolve();
              } else {
                setTimeout(checkLoaded, 50);
              }
            };
            checkLoaded();
          });
        }
        
        musicPlayer.volume = 0;
        await musicPlayer.play();
        
        playBtn.textContent = 'â¸';
        isMusicPlaying = true;
        
        await fadeInAudio(musicPlayer, 500);
        
        setTimeout(() => {
          startRealVisualizer();
        }, 100);
        
        if (isControlCenterMode) {
          const currentTrack = getCurrentTrackInfo();
          addLog('info', `ğŸµ ì¬ìƒ: ${currentTrack?.title || 'ì•Œ ìˆ˜ ì—†ìŒ'}`);
          updateControlCenterPlaylist();
        }
        
      } catch (error) {
        console.error('âŒ ì•ˆì „í•œ ì¬ìƒ ì‹¤íŒ¨:', error);
        playBtn.textContent = 'â¸';
        isMusicPlaying = true;
        audioVisualizer.classList.add('playing');
        startFallbackVisualizer();
        
        if (isControlCenterMode) {
          addLog('error', `ì¬ìƒ ì‹¤íŒ¨: ${error.message}`);
        }
      }
    }

    // ì»¨íŠ¸ë¡¤ ì„¼í„° ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë“¤
    function updateControlCenterInfo() {
      if (!isControlCenterMode) return;
      updateControlCenterPlaylist();
      updateControlCenterEQ();
      updateControlCenterVolumeStatus();
      updateControlCenterEffectVolumes();
      updateBackgroundSelector();
      updatePlaylistSelector();
    }

    function updateControlCenterPlaylist() {
      if (!isControlCenterMode) return;
      
      const shuffleStatus = document.getElementById('shuffleStatus');
      const playlistDisplay = document.getElementById('playlistDisplay');
      
      if (shuffleStatus) {
        shuffleStatus.textContent = `ì…”í”Œ ëª¨ë“œ: ${isShuffleMode ? 'ON' : 'OFF'} | ë°©ì†¡ìš© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸: ${broadcastPlaylist.length}ê³¡`;
      }
      
      if (!playlistDisplay) return;
      
      const playlist = getCurrentPlaylist();
      
      const scrollContainer = playlistDisplay;
      const savedScrollTop = scrollContainer.scrollTop;
      const savedScrollHeight = scrollContainer.scrollHeight;
      const savedClientHeight = scrollContainer.clientHeight;
      const scrollRatio = savedScrollHeight > 0 ? savedScrollTop / (savedScrollHeight - savedClientHeight) : 0;
      
      playlistDisplay.innerHTML = '';
      
      if (playlist.length === 0) {
        const emptyMsg = document.createElement('div');
        emptyMsg.style.cssText = 'text-align: center; color: #90A4AE; padding: 20px; font-size: 11px;';
        emptyMsg.textContent = 'í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤';
        playlistDisplay.appendChild(emptyMsg);
        return;
      }
      
      playlist.forEach((track, index) => {
        const item = document.createElement('div');
        const isCurrentTrack = index === currentTrackIndex;
        item.className = 'playlist-item' + (isCurrentTrack ? ' current' : '');
        item.id = `playlist-track-${index}`;
        
        const trackTitle = document.createElement('span');
        trackTitle.textContent = `${(index + 1).toString().padStart(3, '0')}. ${track.title}`;
        trackTitle.style.flex = '1';
        trackTitle.style.overflow = 'hidden';
        trackTitle.style.textOverflow = 'ellipsis';
        trackTitle.style.whiteSpace = 'nowrap';
        trackTitle.style.marginRight = '8px';
        trackTitle.style.fontWeight = isCurrentTrack ? 'bold' : 'normal';
        
        const trackInfo = document.createElement('span');
        trackInfo.className = 'track-info';
        trackInfo.textContent = track.playlist ? `[${track.playlist}]` : '';
        trackInfo.style.flexShrink = '0';
        
        const status = document.createElement('span');
        status.className = 'track-status available';
        if (isCurrentTrack && isMusicPlaying) {
          status.textContent = 'â–¶';
          status.style.color = '#4CAF50';
          status.style.fontWeight = 'bold';
        } else if (isCurrentTrack) {
          status.textContent = 'â¸';
          status.style.color = '#FF9800';
          status.style.fontWeight = 'bold';
        } else {
          status.textContent = 'âœ“';
        }
        status.style.marginLeft = '8px';
        status.style.flexShrink = '0';
        
        item.appendChild(trackTitle);
        item.appendChild(trackInfo);
        item.appendChild(status);
        playlistDisplay.appendChild(item);
        
        item.addEventListener('click', async () => {
          if (index !== currentTrackIndex) {
            if (isMusicPlaying && musicPlayer) {
              await fadeOutAudio(musicPlayer, 500);
              musicPlayer.pause();
            }
            
            loadTrack(index);
            
            setTimeout(async () => {
              if (isMusicPlaying || musicPlayer.paused === false) {
                await playMusicSafely();
              }
              updateControlCenterPlaylist();
            }, 1500);
          }
        });
      });
      
      requestAnimationFrame(() => {
        const newScrollHeight = scrollContainer.scrollHeight;
        const newClientHeight = scrollContainer.clientHeight;
        
        if (savedScrollHeight > 0 && newScrollHeight > 0) {
          const maxScroll = newScrollHeight - newClientHeight;
          scrollContainer.scrollTop = Math.max(0, Math.min(maxScroll, scrollRatio * maxScroll));
        }
      });
    }

    function updateControlCenterVolumeStatus() {
      if (!isControlCenterMode) return;
      
      const volumeStatus = document.getElementById('volumeStatus');
      if (!volumeStatus) return;
      
      if (isMusicPlaying && musicPlayer && musicPlayer.src) {
        const currentTrack = getCurrentTrackInfo();
        volumeStatus.innerHTML = `
          í˜„ì¬ íŠ¸ë™: ${currentTrack?.title || 'ì•Œ ìˆ˜ ì—†ìŒ'}<br>
          í”Œë ˆì´ë¦¬ìŠ¤íŠ¸: ${currentTrack?.playlist || 'ê¸°ë³¸'}<br>
          ì¬ìƒ ìƒíƒœ: ì¬ìƒ ì¤‘<br>
          ë§ˆìŠ¤í„° ë³¼ë¥¨: ${Math.round((musicPlayer.volume || 0.5) * 100)}%<br>
          ë¶„ì„ ìƒíƒœ: ì •ìƒ
        `;
      } else {
        volumeStatus.innerHTML = `
          í˜„ì¬ íŠ¸ë™: ì—†ìŒ<br>
          í”Œë ˆì´ë¦¬ìŠ¤íŠ¸: ì„ íƒëœ ${selectedPlaylists?.length || 0}ê°œ<br>
          ì¬ìƒ ìƒíƒœ: ì •ì§€<br>
          ë§ˆìŠ¤í„° ë³¼ë¥¨: ${Math.round(audioManager.baseVolume * 100)}%<br>
          ë¶„ì„ ìƒíƒœ: ëŒ€ê¸° ì¤‘
        `;
      }
    }

    function updateControlCenterEffectVolumes() {
      if (!isControlCenterMode) return;
      
      const effectVolumeControls = document.getElementById('effectVolumeControls');
      if (!effectVolumeControls) return;
      
      effectVolumeControls.innerHTML = '<h4>ğŸ”Š íš¨ê³¼ìŒ ë³¼ë¥¨ (8ì±„ë„)</h4>';
      
      effectSounds.forEach((effect, index) => {
        const volume = effectVolumes[effect] || (effect === 'rain' ? 0.95 : 0.5);
        const isActive = currentEffect === effect;
        
        const control = document.createElement('div');
        control.className = 'control-slider' + (isActive ? ' active' : '');
        control.innerHTML = `
          <div class="control-label">
            <span class="effect-name">${effect.charAt(0).toUpperCase() + effect.slice(1)}</span>
            <span class="channel-info">CH${index + 1}</span>
          </div>
          <div class="slider-container">
            <input type="range" class="control-range" id="effect-${effect}-slider" 
                   min="0" max="100" step="5" value="${volume * 100}">
            <button class="test-btn" data-effect="${effect}">TEST</button>
          </div>
          <div class="control-value">${(volume * 100).toFixed(0)}%</div>
        `;
        effectVolumeControls.appendChild(control);
        
        const slider = control.querySelector(`#effect-${effect}-slider`);
        slider.addEventListener('input', (e) => {
          const newVolume = parseInt(e.target.value) / 100;
          effectVolumes[effect] = newVolume;
          
          if (currentEffect === effect) {
            const effectAudio = document.getElementById(`effect-${effect}`);
            if (effectAudio) {
              effectAudio.volume = Math.max(0, Math.min(1, newVolume));
            }
          }
          
          const valueDisplay = control.querySelector('.control-value');
          valueDisplay.textContent = `${(newVolume * 100).toFixed(0)}%`;
          
          addLog('info', `${effect} ë³¼ë¥¨: ${(newVolume * 100).toFixed(0)}%`);
        });
        
        const testBtn = control.querySelector('.test-btn');
        testBtn.addEventListener('click', () => {
          toggleEffect(effect);
        });
      });
      
      setupMasterVolumeControl();
    }

    function updateControlCenterEQ() {
      // EQ ê´€ë ¨ í•¨ìˆ˜ëŠ” ì´ë¯¸ êµ¬í˜„ë¨
    }

    function setupControlCenterEQControls() {
      ['eqLowSlider', 'eqMidSlider', 'eqHighSlider'].forEach(sliderId => {
        const slider = document.getElementById(sliderId);
        if (slider) {
          slider.addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            const eqType = sliderId.replace('Slider', '').replace('eq', '').toLowerCase();
            
            if (eqType === 'low' && eqLow) {
              eqLow.gain.value = value;
            } else if (eqType === 'mid' && eqMid) {
              eqMid.gain.value = value;
            } else if (eqType === 'high' && eqHigh) {
              eqHigh.gain.value = value;
            }
            
            const valueElement = document.getElementById(`eq${eqType.charAt(0).toUpperCase() + eqType.slice(1)}Value`);
            if (valueElement) {
              valueElement.textContent = `${value}dB`;
            }
            addLog('info', `${eqType.toUpperCase()} EQ: ${value}dB`);
          });
        }
      });
    }

    function setupMasterVolumeControl() {
      const masterSlider = document.getElementById('master-volume-slider-main');
      const masterValueDisplay = document.getElementById('master-volume-value-main');
      
      if (masterSlider && masterValueDisplay) {
        const currentVolume = Math.round(audioManager.baseVolume * 100);
        masterSlider.value = currentVolume;
        masterValueDisplay.textContent = `${currentVolume}%`;
        
        masterSlider.addEventListener('input', (e) => {
          const value = parseInt(e.target.value) / 100;
          audioManager.setBaseVolume(value);
          
          masterValueDisplay.textContent = `${Math.round(value * 100)}%`;
          addLog('info', `ë§ˆìŠ¤í„° ë³¼ë¥¨: ${Math.round(value * 100)}%`);
          
          setTimeout(updateControlCenterVolumeStatus, 100);
        });
      }
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
    musicPlayer._audioSourceConnected = false;
    
    musicPlayer.addEventListener('ended', () => {
      isMusicPlaying = false;
      playBtn.textContent = 'â–¶';
      stopVisualizer();
      
      const playlist = getCurrentPlaylist();
      let newIndex = currentTrackIndex + 1;
      if (newIndex >= playlist.length) {
        newIndex = 0;
        if (isShuffleMode) {
          shuffledPlaylist = createShuffledPlaylist();
        }
      }
      
      currentTrackIndex = newIndex;
      
      const nextTrack = playlist[newIndex];
      if (nextTrack) {
        musicPlayer.src = nextTrack.src;
        musicPlayer.volume = Math.max(0, Math.min(1, audioManager.baseVolume));
        
        if (isControlCenterMode) {
          updateControlCenterPlaylist();
        }
        
        setTimeout(() => {
          playMusicSafely();
        }, 1000);
      }
    });

    // ë°©ì†¡ ì‹œì‘
    startButton.addEventListener("click", () => {
      startButton.style.display = "none";
      isBroadcasting = true;

      // ğŸ†• ë°°ê²½ íƒ€ì… í™•ì¸ í›„ ì¡°ê±´ë¶€ ì¬ìƒ
      const backgroundType = document.querySelector('input[name="backgroundType"]:checked')?.value || 'video';
      
      if (backgroundType === 'video') {
        // ë¹„ë””ì˜¤ ëª¨ë“œì¼ ë•Œë§Œ ë£¨í”„ ì˜ìƒ ì¬ìƒ
        playLoop(loop1, loop2);
      } 
            if (overlayVideo) {
        overlayVideo.currentTime = 0;
        fadeIn(overlayVideo);
        overlayVideo.play().catch(error => console.error("Overlay video play failed:", error));
      }
      else {
        // ì´ë¯¸ì§€ ëª¨ë“œì¼ ë•ŒëŠ” ë£¨í”„ ì˜ìƒ ìˆ¨ê¹€
        fadeOut(loop1);
        fadeOut(loop2);
        loop1.pause();
        loop2.pause();
      }
      
      controlPanel.classList.add('show');
      titleDisplay.classList.add('show');

        // ğŸ†• ì¸íŠ¸ë¡œ ì¬ìƒ ë¡œì§ ì¶”ê°€ - ê°œì„ ëœ ë²„ì „

           // ğŸ†• ì¸íŠ¸ë¡œ ì¬ìƒ ë¡œì§ ì¶”ê°€
    const introEnabledCheckbox = document.getElementById('introEnabled');
      if (window.introVideoUrl && (!introEnabledCheckbox || introEnabledCheckbox.checked)) {
        setTimeout(() => {
          playIntroVideo();
        }, 1000);
      } else {
      }
      
      if (musicTracks && musicTracks.length > 0) {
        if (!shuffledPlaylist || shuffledPlaylist.length === 0) {
          shuffledPlaylist = createShuffledPlaylist();
        }
        shuffleBtn.classList.add('active');
        loadTrack(0);
        
        setTimeout(() => {
          toggleMusic();
        }, 1000);
        
        if (isControlCenterMode) {
          addLog('info', 'ğŸ¬ ë°©ì†¡ ì‹œì‘');
        }
      } else {
        setTimeout(() => {
          loadExternalPlaylists();
          
          if (musicTracks && musicTracks.length > 0) {
            shuffledPlaylist = createShuffledPlaylist();
            shuffleBtn.classList.add('active');
            loadTrack(0);
            setTimeout(toggleMusic, 500);
            
            if (isControlCenterMode) {
              addLog('info', 'í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì¬ë¡œë“œ ì„±ê³µ');
            }
          } else if (broadcastPlaylist && broadcastPlaylist.length > 0) {
            musicTracks = [...broadcastPlaylist];
            shuffledPlaylist = createShuffledPlaylist();
            shuffleBtn.classList.add('active');
            loadTrack(0);
            setTimeout(toggleMusic, 500);
            
            if (isControlCenterMode) {
              addLog('info', 'ë°©ì†¡ìš© í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©');
            }
          }
        }, 2000);
      }
    });

    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        location.reload();
      } else if (e.key === ' ') {
        e.preventDefault();
        if (isBroadcasting) {
          toggleMusic();
        }
      } else if (e.key === 't' || e.key === 'T') {
        e.preventDefault();
        toggleControlCenter();
      }
    });

    // ìŠ¤í¬ë¡¤ ì œì–´
    document.addEventListener('wheel', (e) => {
      const controlCenter = document.getElementById('controlCenter');
      const playlistDisplay = document.getElementById('playlistDisplay');
      const logDisplay = document.querySelector('.log-display');
      
      let currentElement = e.target;
      let allowScroll = false;
      let depth = 0;
      
      while (currentElement && currentElement !== document.body && depth < 10) {
        if (currentElement === controlCenter || 
            currentElement === playlistDisplay || 
            currentElement === logDisplay ||
            currentElement.classList?.contains('test-panel') ||
            currentElement.classList?.contains('control-section') ||
            currentElement.id === 'playlistDisplay' ||
            currentElement.id === 'logDisplay') {
          allowScroll = true;
          break;
        }
        currentElement = currentElement.parentElement;
        depth++;
      }
      
      if (!allowScroll) {
        e.preventDefault();
        e.stopPropagation();
        return false;
      }
    }, { passive: false });

    // ì´ˆê¸°í™”
    effectSounds.forEach(effect => {
      effectVolumes[effect] = effect === 'rain' ? 0.95 : 0.5;
    });
    
    audioManager.setBaseVolume(0.5);
// ì˜¤ë²„ë ˆì´ ì ìš© í•¨ìˆ˜
function applyOverlay() {
  if (!window.pendingOverlayFile) {
    addLog('error', 'ì„ íƒëœ ì˜¤ë²„ë ˆì´ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤');
    return;
  }
  
  const overlayVideo = document.getElementById('overlayVideo');
  const overlayEnabled = document.getElementById('overlayEnabled');
  
  if (!overlayVideo) {
    addLog('error', 'ì˜¤ë²„ë ˆì´ ë¹„ë””ì˜¤ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    return;
  }
  
  
  try {
    // ê¸°ì¡´ ë¹„ë””ì˜¤ ì™„ì „ ì •ì§€
    overlayVideo.pause();
    overlayVideo.currentTime = 0;
    overlayVideo.style.opacity = '0';
    
    // ìƒˆ ì†ŒìŠ¤ ì„¤ì • - source íƒœê·¸ì™€ ì§ì ‘ src ëª¨ë‘ ì‹œë„
    const source = overlayVideo.querySelector('source');
    if (source) {
      source.src = window.pendingOverlayFile.url;
      source.type = 'video/mp4';
    }
    overlayVideo.src = window.pendingOverlayFile.url;
    
    // ë¹„ë””ì˜¤ ì†ì„± ì„¤ì •
    overlayVideo.muted = true;
    overlayVideo.loop = true;
    overlayVideo.preload = 'auto';
    
    debugLog('ğŸ”„ ì˜¤ë²„ë ˆì´ ë¹„ë””ì˜¤ ë¡œë“œ ì‹œì‘...');
    
    // ë¹„ë””ì˜¤ ë‹¤ì‹œ ë¡œë“œ
    overlayVideo.load();
    
    // ë¡œë“œ ì™„ë£Œ í›„ ì²˜ë¦¬
    overlayVideo.addEventListener('loadeddata', function onLoaded() {

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (í•œ ë²ˆë§Œ ì‹¤í–‰)
      overlayVideo.removeEventListener('loadeddata', onLoaded);

      // ğŸ”§ ìˆ˜ì •: í•­ìƒ ì¬ìƒ ì‹œë„ (í™œì„±í™” ì—¬ë¶€ëŠ” opacityë¡œë§Œ ì œì–´)
      overlayVideo.currentTime = 0;

      overlayVideo.play().then(() => {
        console.log('âœ… ì˜¤ë²„ë ˆì´ ë¹„ë””ì˜¤ ì¬ìƒ ì„±ê³µ');

        // í™œì„±í™” ìƒíƒœì— ë”°ë¼ opacity ì„¤ì •
        if (overlayEnabled && overlayEnabled.checked) {
          overlayVideo.style.transition = `opacity ${CONFIG.TIMING.FADE_SLOW}ms ease`;
          overlayVideo.style.opacity = CONFIG.OPACITY.DEFAULT_OVERLAY;
          addLog('info', `ì˜¤ë²„ë ˆì´ ì¬ìƒ ì‹œì‘: ${window.pendingOverlayFile.name}`);
        } else {
          overlayVideo.style.opacity = '0';
          addLog('info', 'ì˜¤ë²„ë ˆì´ íŒŒì¼ ì ìš©ë¨ (ë¹„í™œì„±í™” ìƒíƒœ - ì²´í¬ë°•ìŠ¤ë¥¼ ì¼œë©´ ë³´ì…ë‹ˆë‹¤)');
        }
      }).catch(error => {
        console.error('âŒ ì˜¤ë²„ë ˆì´ ì¬ìƒ ì‹¤íŒ¨:', error);
        addLog('error', `ì˜¤ë²„ë ˆì´ ì¬ìƒ ì‹¤íŒ¨: ${error.message}`);

        // ì¬ìƒ ì‹¤íŒ¨ ì‹œì—ë„ opacity ì„¤ì •
        if (overlayEnabled && overlayEnabled.checked) {
          overlayVideo.style.opacity = CONFIG.OPACITY.DEFAULT_OVERLAY;
        }
      });

      // ìƒíƒœ ì—…ë°ì´íŠ¸
      updateOverlayStatus(true);

    }, { once: true }); // once: trueë¡œ í•œ ë²ˆë§Œ ì‹¤í–‰
    
    // ë¡œë“œ ì—ëŸ¬ ì²˜ë¦¬
    overlayVideo.addEventListener('error', function onError(e) {
      console.error('âŒ ì˜¤ë²„ë ˆì´ ë¡œë“œ ì—ëŸ¬:', e);
      addLog('error', `ì˜¤ë²„ë ˆì´ ë¡œë“œ ì‹¤íŒ¨: ${window.pendingOverlayFile.name}`);
      
      // ì—ëŸ¬ ìƒíƒœ í‘œì‹œ
      const statusElement = document.getElementById('overlayFileStatus');
      if (statusElement) {
        statusElement.textContent = `ì˜¤ë¥˜: ${window.pendingOverlayFile.name} (ë¡œë“œ ì‹¤íŒ¨)`;
        statusElement.style.color = '#E57373';
      }
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
      overlayVideo.removeEventListener('error', onError);
    }, { once: true });
    
    // 5ì´ˆ íƒ€ì„ì•„ì›ƒ ì•ˆì „ì¥ì¹˜
    setTimeout(() => {
      if (overlayVideo.readyState < 2) { // HAVE_CURRENT_DATA
        console.warn('âš ï¸ ì˜¤ë²„ë ˆì´ ë¡œë“œ íƒ€ì„ì•„ì›ƒ');
        addLog('warning', 'ì˜¤ë²„ë ˆì´ ë¡œë“œê°€ ëŠë¦½ë‹ˆë‹¤. ë°±ê·¸ë¼ìš´ë“œì—ì„œ ê³„ì† ë¡œë“œ ì¤‘...');
        updateOverlayStatus(true); // ì¼ë‹¨ ì ìš©ëœ ê²ƒìœ¼ë¡œ ì²˜ë¦¬
      }
    }, 5000);
    
  } catch (error) {
    console.error('âŒ ì˜¤ë²„ë ˆì´ ì ìš© ì¤‘ ì˜¤ë¥˜:', error);
    addLog('error', `ì˜¤ë²„ë ˆì´ ì ìš© ì˜¤ë¥˜: ${error.message}`);
  }
}

// ì˜¤ë²„ë ˆì´ ìƒíƒœ ì—…ë°ì´íŠ¸ í—¬í¼ í•¨ìˆ˜
function updateOverlayStatus(applied = false) {
  const statusElement = document.getElementById('overlayFileStatus');
  const applyBtn = document.getElementById('applyOverlayBtn');
  
  if (applied && window.pendingOverlayFile) {
    if (statusElement) {
      statusElement.textContent = `í˜„ì¬: ${window.pendingOverlayFile.name}`;
      statusElement.style.color = '#4CAF50';
    }
    
    if (applyBtn) {
      applyBtn.disabled = true;
      applyBtn.style.background = '#666';
      applyBtn.textContent = 'ì ìš©ë¨';
    }
    
    addLog('info', `âœ… ì˜¤ë²„ë ˆì´ ì ìš© ì™„ë£Œ: ${window.pendingOverlayFile.name}`);
    
    // í˜„ì¬ ì ìš©ëœ ì˜¤ë²„ë ˆì´ ì •ë³´ ì €ì¥
    window.currentOverlayFile = { ...window.pendingOverlayFile };
    window.pendingOverlayFile = null;
  }
}


   // ğŸ”Š í´ë¦­ ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜
    function playClickSound() {
      try {
        const clickSound = document.getElementById('clickSound');
        if (clickSound) {
          clickSound.currentTime = 0;
          clickSound.volume = 0.3;
          clickSound.play().catch(e => debugLog('í´ë¦­ ì†Œë¦¬ ì¬ìƒ ì‹¤íŒ¨:', e));
        }
      } catch (error) {
        // ì—ëŸ¬ ë¬´ì‹œ (ì†Œë¦¬ ì—†ì–´ë„ ê¸°ëŠ¥ì—ëŠ” ë¬¸ì œì—†ìŒ)
      }
    }
    
    // ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ
    window.setBaseVolume = (volume) => audioManager.setBaseVolume(volume);
    window.applyStealthMode = applyStealthMode;
    window.applyStealthPreset = applyStealthPreset;
    window.resetStealthMode = resetStealthMode;
    window.loadPlaylistFiles = loadPlaylistFiles;
    window.applyBackgroundMedia = applyBackgroundMedia;
    window.applySelectedPlaylists = applySelectedPlaylists;
    window.resetPlaylists = resetPlaylists;
    window.savePreset = savePreset;
    window.loadPreset = loadPreset;
    window.deletePreset = deletePreset;
    window.exportPreset = exportPreset;
    window.applyOverlay = applyOverlay;
    window.applyIntro = applyIntro;
    window.updateOverlayStatus = updateOverlayStatus;
    

// í˜ì´ì§€ ë¡œë“œ í›„ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²°
setTimeout(() => {
  const applyOverlayBtn = document.getElementById('applyOverlayBtn');
  if (applyOverlayBtn) {
    applyOverlayBtn.addEventListener('click', () => {
      console.log('ğŸ¬ ì˜¤ë²„ë ˆì´ ì ìš© ë²„íŠ¼ í´ë¦­ë¨');
      applyOverlay();
    });
    console.log('âœ… ì˜¤ë²„ë ˆì´ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²° ì™„ë£Œ');
  } else {
    console.error('âŒ applyOverlayBtn ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
  }
  
  const applyIntroBtn = document.getElementById('applyIntroBtn');
  if (applyIntroBtn) {
    applyIntroBtn.addEventListener('click', () => {
      console.log('ğŸ¬ ì¸íŠ¸ë¡œ ì ìš© ë²„íŠ¼ í´ë¦­ë¨');
      applyIntro();
    });
    console.log('âœ… ì¸íŠ¸ë¡œ ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²° ì™„ë£Œ');
  } else {
    console.error('âŒ applyIntroBtn ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
  }
}, 1000);


    // ê°„ë‹¨í•œ ë””ë²„ê¹… í•¨ìˆ˜ë“¤
window.debugOverlay = function() {
  const v = document.getElementById('overlayVideo');
  console.log('Overlay:', v?.src, 'ready:', v?.readyState, 'paused:', v?.paused);
  if (v?.src) v.play().catch(e => console.error(e));
};
window.testOverlay = function() { const v = document.getElementById('overlayVideo'); v.style.opacity='0.5'; v.play(); };
window.hideOverlay = function() { document.getElementById('overlayVideo').style.opacity='0'; };

  // DOM ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
document.addEventListener('DOMContentLoaded', () => {
  // âœ… í•œ ë²ˆë§Œ í˜¸ì¶œë˜ë„ë¡ ìˆ˜ì •
  if (!window._initialSetupComplete) {

  
    // DOM ìºì‹± ì‹œìŠ¤í…œ ì´ˆê¸°í™” (ìµœìš°ì„ )
    DOM.init();

    // ëª¨ë“  ì´ˆê¸°í™” í•¨ìˆ˜ë¥¼ ì—¬ê¸°ì— ëª¨ì•„ì„œ í˜¸ì¶œí•©ë‹ˆë‹¤.
    loadExternalPlaylists();
    setupDragAndDrop();
    setupControlCenterEQControls();
    setupStealthControls();
    setupMasterVolumeControl();

    setupMediaControls('overlay');
    setupMediaControls('intro');

    window._initialSetupComplete = true;
  }

  if (isControlCenterMode) {
    addLog('info', 'Melony ì¢Œìš° ë¶„í•  ì‹œìŠ¤í…œ ì‹œì‘');
  }
});

  </script>
</body>
</html>
